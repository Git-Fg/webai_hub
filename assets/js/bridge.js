(function(){"use strict";const g=["input-area","textarea[placeholder*='Prompt']","textarea[aria-label*='prompt'], textarea[aria-label*='Prompt']",".ql-editor","div[contenteditable='true']","textarea"],p=['send-button[variant="primary"]','button[aria-label*="Send"], button[aria-label*="send"]','button mat-icon:contains("send")',".send-button button",'button[type="submit"]','button:contains("Send")'],d=["response-container",".response-message",".message-response",".markdown",".response-content","[data-testid*='response']",".message-content"],f=['mat-icon[data-mat-icon-name="stop"]',".generating-indicator",".loading-indicator","[data-testid*='generating']",".spinner",".loading-spinner",".thinking-indicator"];function m(e,t=1e4){return new Promise((o,n)=>{let c=0;const s=setInterval(()=>{for(const r of e){const i=document.querySelector(r);if(i){clearInterval(s),console.log(`Found element with selector: ${r}`),o(i);return}}c+=300,c>=t&&(clearInterval(s),n(new Error(`None of the selectors [${e.join(", ")}] found within ${t}ms`)))},300)})}function E(){console.log("=== DEBUG: Page Elements ===");const e=document.querySelectorAll('textarea, input[type="text"], [contenteditable="true"]');console.log(`Found ${e.length} text inputs:`,e);const t=document.querySelectorAll("button");console.log(`Found ${t.length} buttons:`,t);const o=document.querySelectorAll('[class*="response"], [class*="message"], [class*="content"]');console.log(`Found ${o.length} response containers:`,o)}function l(e){window.flutter_inappwebview?window.flutter_inappwebview.callHandler("automationBridge",e):console.log("Mock Dart Notification:",e)}async function b(e){try{console.log("Starting automation with prompt:",e),E(),console.log("Looking for input element...");const t=await m(g);t.tagName==="TEXTAREA"||t.tagName==="INPUT"?(t.value=e,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))):t.contentEditable==="true"?(t.innerText=e,t.dispatchEvent(new Event("input",{bubbles:!0}))):(t.click(),await new Promise(n=>setTimeout(n,500)),t.value=e),console.log("Prompt inserted successfully"),console.log("Looking for send button..."),(await m(p)).click(),console.log("Send button clicked, waiting for response..."),await new Promise(n=>setTimeout(n,2e3)),await new Promise((n,a)=>{let s=0;const r=async()=>{if(s++,console.log(`Checking for response... (${s})`),f.some(u=>document.querySelector(u))){console.log("Generation in progress..."),setTimeout(r,2e3);return}d.map(u=>document.querySelectorAll(u)).flat().length>0?(console.log("Response found!"),l({type:"GENERATION_COMPLETE"}),n()):s*2e3>=45e3?(console.log("Generation timeout - no response found"),l({type:"GENERATION_COMPLETE"}),n()):setTimeout(r,2e3)};r()})}catch(t){throw console.error("Automation failed:",t),l({type:"AUTOMATION_FAILED",payload:t instanceof Error?t.message:String(t)}),t}}async function T(){try{console.log("Extracting final response...");let e=[];for(const n of d){const a=Array.from(document.querySelectorAll(n));e.push(...a)}if(e.length===0&&(console.log("Trying broader search for response content..."),e=Array.from(document.querySelectorAll("*")).filter(a=>{const s=(a.innerText?.trim()||"").length>50,r=!a.matches("input, textarea, button, select, option"),i=a.offsetParent!==null;return s&&r&&i})),e.length===0)return console.log("No response found, returning page content as fallback"),(document.body?.innerText||"").trim()||"No response available";const o=e[e.length-1].innerText?.trim()||"";return console.log(`Extracted response (${o.length} characters)`),o}catch(e){throw console.error("Extraction failed:",e),l({type:"AUTOMATION_FAILED",payload:e instanceof Error?e.message:String(e)}),e}}window.startAutomation=b,window.extractFinalResponse=T})();
