(function(){"use strict";const m=["input-area","textarea[placeholder*='Prompt']","textarea[aria-label*='prompt'], textarea[aria-label*='Prompt']",".ql-editor","div[contenteditable='true']","textarea"],p=['send-button[variant="primary"]','button[aria-label*="Send"], button[aria-label*="send"]','button mat-icon:contains("send")',".send-button button",'button[type="submit"]','button:contains("Send")'],b=["response-container",".response-message",".message-response",".markdown",".response-content","[data-testid*='response']",".message-content"],d=['mat-icon[data-mat-icon-name="stop"]',".generating-indicator",".loading-indicator","[data-testid*='generating']",".spinner",".loading-spinner",".thinking-indicator"];function l(e,t=1e4){return new Promise((u,n)=>{let a=0;const r=setInterval(()=>{for(const s of e){const i=document.querySelector(s);if(i){clearInterval(r),u(i);return}}a+=300,a>=t&&(clearInterval(r),n(new Error(`None of the selectors [${e.join(", ")}] found within ${t}ms`)))},300)})}function E(){document.querySelectorAll('textarea, input[type="text"], [contenteditable="true"]'),document.querySelectorAll("button"),document.querySelectorAll('[class*="response"], [class*="message"], [class*="content"]')}function c(e){window.flutter_inappwebview&&window.flutter_inappwebview.callHandler("automationBridge",e)}async function T(e){try{E();const t=await l(m);t.tagName==="TEXTAREA"||t.tagName==="INPUT"?(t.value=e,t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))):t.contentEditable==="true"?(t.innerText=e,t.dispatchEvent(new Event("input",{bubbles:!0}))):(t.click(),await new Promise(n=>setTimeout(n,500)),t.value=e),(await l(p)).click(),console.log("Automation sent. Now observing for response completion..."),await l(d,5e3),console.log("Generation indicator appeared. Observing for its disappearance."),await new Promise(n=>{const o=new MutationObserver((r,s)=>{document.querySelector(d[0])||(console.log("Generation indicator disappeared. Generation complete."),c({type:"GENERATION_COMPLETE"}),s.disconnect(),clearTimeout(a),n())});o.observe(document.body,{childList:!0,subtree:!0});const a=setTimeout(()=>{console.warn("Observation timed out after 45s. Assuming completion."),o.disconnect(),c({type:"GENERATION_COMPLETE"}),n()},45e3)})}catch(t){throw c({type:"AUTOMATION_FAILED",payload:t instanceof Error?t.message:String(t)}),t}}async function f(){try{let e=[];for(const n of b){const o=Array.from(document.querySelectorAll(n));e.push(...o)}return e.length===0&&(e=Array.from(document.querySelectorAll("*")).filter(o=>{const r=(o.innerText?.trim()||"").length>50,s=!o.matches("input, textarea, button, select, option"),i=o.offsetParent!==null;return r&&s&&i})),e.length===0?(document.body?.innerText||"").trim()||"No response available":e[e.length-1].innerText?.trim()||""}catch(e){throw c({type:"AUTOMATION_FAILED",payload:e instanceof Error?e.message:String(e)}),e}}window.startAutomation=T,window.extractFinalResponse=f})();
