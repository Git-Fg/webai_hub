(function(){"use strict";const K="automationBridge",V="bridgeReady",$="NEW_RESPONSE_DETECTED",Y="LOGIN_REQUIRED",N="AUTOMATION_FAILED",X="AUTOMATION_RETRY_REQUIRED";function I(s){const e=window;e.flutter_inappwebview&&e.flutter_inappwebview.callHandler(K,s)}function w(s){const e=window.__AI_TIMEOUT_MODIFIER__??1;return s*e}const M=1e4,G=300,P=2,z=300,Z=2e3;function j(){return{url:window.location.href,readyState:document.readyState,visibleElementsCount:document.querySelectorAll("*").length}}function B(s,e,n,t="waitForElement"){const o=j();return`${t} failed: None of the selectors [${s.join(", ")}] found within ${e}ms
Context: URL=${o.url}, Timeout=${e}ms, Elapsed=${n}ms
Page State: Ready=${o.readyState}, VisibleElements=${o.visibleElementsCount}`}function U(s,e,n){for(let t=0;t<s.length;t++){const o=s[t];if(!o)continue;let i=null;try{e?i=e.querySelector(o):i=document.querySelector(o)}catch(r){console.warn(`[${n}] Invalid selector "${o}" (index ${t}):`,r);continue}if(i)return i}return null}async function k(s,e,n="waitForElement",t){return new Promise((o,i)=>{const r=Date.now();let a=0,c=null,l=null,E=null,m=!1;console.log(`[${n}] Starting search for selectors: [${s.join(", ")}] (timeout: ${e}ms)`);const d=()=>{c&&(c.disconnect(),c=null),l!==null&&(clearTimeout(l),l=null),E!==null&&(clearInterval(E),E=null)},f=()=>{const u=Date.now()-r;u-a>=Z&&(console.log(`[${n}] Still searching... (elapsed: ${u}ms, remaining: ${e-u}ms)`),a=u),m||(U(s,t,n)||console.log(`[${n}] Selectors not found on first attempt`),m=!0);const g=U(s,t,n);if(g){const p=Date.now()-r,A=s.find(L=>{if(!L)return!1;try{return t?t.querySelector(L)===g:document.querySelector(L)===g}catch{return!1}});console.log(`[${n}] Found element with selector "${A||"unknown"}" after ${p}ms`),d(),o(g);return}if(u>=e){d();const p=B(s,e,u,n);i(new Error(p))}};if(typeof MutationObserver<"u"){c=new MutationObserver(()=>{f()});const u=t||document.body;c.observe(u,{childList:!0,subtree:!0}),f()}else console.warn(`[${n}] MutationObserver not available, using polling fallback`),E=window.setInterval(f,G),f();l=window.setTimeout(()=>{d();const u=Date.now()-r,g=B(s,e,u,n);i(new Error(g))},e)})}function _(s,e=M,n=P){const t=w(e);return R(()=>k(s,t,"waitForElement"),n,"waitForElement")}function x(s,e,n=M,t=P){const o=w(n);return R(()=>k(e,o,"waitForElementWithin",s),t,"waitForElementWithin")}function v(s,e,n=M,t=P){const o=w(n);return R(()=>Q(s,e,o),t,"waitForElementByText")}async function Q(s,e,n){return new Promise((t,o)=>{const i=Date.now();let r=null,a=null;const c=()=>{r&&(r.disconnect(),r=null),a!==null&&(clearTimeout(a),a=null)},l=()=>{const E=document.querySelectorAll(s);for(const d of E)if(d.textContent?.includes(e)){const f=Date.now()-i;console.log(`[waitForElementByText] Found element with text "${e}" after ${f}ms`),c(),t(d);return}Date.now()-i>=n&&(c(),o(new Error(`Element with selector "${s}" containing text "${e}" not found within ${n}ms`)))};if(typeof MutationObserver<"u")r=new MutationObserver(()=>{l()}),r.observe(document.body,{childList:!0,subtree:!0}),l();else{console.warn("[waitForElementByText] MutationObserver not available, using polling fallback");const E=window.setInterval(l,G);l(),a=window.setTimeout(()=>{clearInterval(E),c(),o(new Error(`Element with selector "${s}" containing text "${e}" not found within ${n}ms`))},n)}})}async function R(s,e,n){let t=null;for(let o=0;o<=e;o++)try{return await s()}catch(i){if(t=i instanceof Error?i:new Error(String(i)),!(t.message.includes("not found")||t.message.includes("timeout")||t.message.includes("None of the selectors"))||o>=e)throw t;const a=z*Math.pow(2,o);console.log(`[${n}] Retry ${o+1}/${e} after ${a}ms delay. Error: ${t.message.split(`
`)[0]}`),await new Promise(c=>setTimeout(c,a))}throw t||new Error(`Operation ${n} failed after ${e} retries`)}const J=1e4,ee=2,F=1e3,te=2e3;function ne(s){return s.isConnected===!0}function oe(s){if(typeof s.checkVisibility=="function")try{return s.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0})}catch{}return s.offsetParent!==null}async function ie(s,e=F){try{const n=s.getAnimations();if(n.length===0)return!0;const t=n.map(i=>i.finished);return await Promise.race([Promise.all(t),new Promise(i=>setTimeout(i,e))]),s.getAnimations().length===0}catch{return!0}}function re(s){if(s.disabled===!0||s.getAttribute("aria-disabled")==="true"||s.hasAttribute("inert"))return!1;let n=s.parentElement;for(;n;){if(n.hasAttribute("inert"))return!1;n=n.parentElement}return!0}function se(s){try{const e=s.getBoundingClientRect(),n=e.left+e.width/2,t=e.top+e.height/2,o=document.elementFromPoint(n,t);return o?s.contains(o)||o===s:!1}catch{return!0}}async function H(s,e=F){const n=s,t={attached:!1,visible:!1,stable:!1,enabled:!1,unoccluded:!1,details:{}};if(t.attached=ne(s),t.details.isConnected=s.isConnected,!t.attached)return{actionable:!1,diagnostics:t};t.visible=oe(n);try{typeof n.checkVisibility=="function"&&(t.details.checkVisibilityResult=n.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0}))}catch{}if(t.details.offsetParent=n.offsetParent,!t.visible)return{actionable:!1,diagnostics:t};t.stable=await ie(n,e);try{const i=n.getAnimations();t.details.animationsCount=i.length}catch{}if(!t.stable)return{actionable:!1,diagnostics:t};if(t.enabled=re(n),t.details.disabled=n.disabled,t.details.ariaDisabled=n.getAttribute("aria-disabled"),t.details.inert=n.hasAttribute("inert"),!t.enabled)return{actionable:!1,diagnostics:t};if(t.unoccluded=se(n),!t.unoccluded)try{const i=n.getBoundingClientRect(),r=i.left+i.width/2,a=i.top+i.height/2;t.details.occludingElement=document.elementFromPoint(r,a)}catch{}return{actionable:t.attached&&t.visible&&t.stable&&t.enabled&&t.unoccluded,diagnostics:t}}function ae(s,e,n,t="element"){const o=[];n.attached||o.push("not attached to DOM"),n.visible||o.push("not visible"),n.stable||o.push("has ongoing animations"),n.enabled||o.push("disabled or inert"),n.unoccluded||o.push("occluded by another element");const i={url:window.location.href,readyState:document.readyState,visibleElements:document.querySelectorAll("*").length};return`${t} is not actionable: ${o.join(", ")}
Selectors: [${s.join(", ")}]
Timeout: ${e}ms
Diagnostics: ${JSON.stringify(n.details,null,2)}
Page State: URL=${i.url}, ReadyState=${i.readyState}, VisibleElements=${i.visibleElements}`}async function le(s,e,n,t){const o=Date.now();let i=0;return console.log(`[waitForActionableElement] Starting search for actionable ${e} with selectors: [${s.join(", ")}] (timeout: ${n}ms)`),new Promise((r,a)=>{let c=null,l=null,E=null;const m=()=>{c&&(c.disconnect(),c=null),l!==null&&(clearTimeout(l),l=null),E!==null&&(clearInterval(E),E=null)},d=async()=>{const f=Date.now()-o;f-i>=te&&(console.log(`[waitForActionableElement] Still checking actionability for ${e}... (elapsed: ${f}ms)`),i=f);for(const u of s){if(!u)continue;let g=null;try{t||(g=document.querySelector(u))}catch(p){console.warn(`[waitForActionableElement] Invalid selector "${u}":`,p);continue}if(g){const{actionable:p,diagnostics:A}=await H(g);if(p){const L=Date.now()-o;console.log(`[waitForActionableElement] Found actionable ${e} with selector "${u}" after ${L}ms`),m(),r(g);return}else console.log(`[waitForActionableElement] Element found but not actionable: ${JSON.stringify(A.details)}`)}}if(f>=n){m();let u=null;for(const g of s)try{if(t||(u=document.querySelector(g)),u)break}catch{}if(u){const{diagnostics:g}=await H(u);a(new Error(ae(s,n,g,e)))}else a(new Error(`waitForActionableElement failed: None of the selectors [${s.join(", ")}] found within ${n}ms`))}};if(typeof MutationObserver<"u"){c=new MutationObserver(()=>{d()});const f=document.body;c.observe(f,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["disabled","aria-disabled","inert","style","class"]}),d()}else console.warn("[waitForActionableElement] MutationObserver not available, using polling fallback"),E=window.setInterval(d,100),d();l=window.setTimeout(()=>{m(),d()},n)})}function O(s,e="element",n=J,t=ee){const o=w(n);return ce(()=>le(s,e,o),t,`waitForActionableElement(${e})`)}async function ce(s,e,n){let t=null;const o=300;for(let i=0;i<=e;i++)try{return await s()}catch(r){if(t=r instanceof Error?r:new Error(String(r)),!(t.message.includes("not found")||t.message.includes("timeout")||t.message.includes("None of the selectors")||t.message.includes("not actionable"))||i>=e)throw t;const c=o*Math.pow(2,i);console.log(`[${n}] Retry ${i+1}/${e} after ${c}ms delay. Error: ${t.message.split(`
`)[0]}`),await new Promise(l=>setTimeout(l,c))}throw t||new Error(`Operation ${n} failed after ${e} retries`)}function S(s,e,n="DOM assertion"){if(!s)throw new Error(`[${n}] Assertion failed: Expected ${e.name}, but the element is null.`);if(!(s instanceof e))throw new Error(`[${n}] Assertion failed: Expected ${e.name}, but got ${s.constructor.name}.`);return s}const y=1e4,b={READINESS_CHECK_INTERVAL_MS:100,TOKEN_COUNT_UPDATE_TIMEOUT_MS:1e4,TOKEN_COUNT_CHECK_INTERVAL_MS:100,UI_STABILIZE_AFTER_TOKEN_COUNT_MS:30,FINALIZED_TURN_TIMEOUT_MS:15e3,FINALIZED_TURN_CHECK_INTERVAL_MS:1e3,EDIT_BUTTON_WAIT_TIMEOUT_MS:2e3,TEXTAREA_APPEAR_TIMEOUT_MS:5e3,UI_STABILIZE_DELAY_MS:150,PANEL_ANIMATION_MS:250,POLL_INTERVAL_MS:100,POLL_TIMEOUT_MS:5e3,UI_STATE_DEBOUNCE_DELAY_MS:250},T={NEW_CHAT_BUTTON:'a[href="/prompts/new_chat"]',RUN_SETTINGS_TOGGLE_MOBILE:"button.runsettings-toggle-button",MODEL_SELECTOR_DESKTOP:"button.model-selector-card",PROMPT_INPUTS:["ms-chunk-input textarea","textarea[placeholder*='Start typing a prompt']","textarea[aria-label*='Start typing a prompt']"],SEND_BUTTONS:['ms-run-button > button[aria-label="Run"]','ms-run-button > button[type="submit"]','button[aria-label="Run"]',"ms-run-button > button"],TOKEN_COUNT:"span.v3-token-count-value",EDIT_BUTTON:['button[aria-label="Edit"]','button[aria-label*="edit" i]','button:has([aria-label*="edit" i])'],EDIT_TEXTAREA:["textarea",'div[contenteditable="true"]','[contenteditable="true"]'],STOP_EDITING_BUTTON:'button[aria-label="Stop editing"]',CHAT_TURN:['[id^="turn-"]',"ms-chat-turn"],SETTINGS_PANEL_MOBILE_TOGGLE:['button[aria-label="Toggle run settings panel"]',"button.runsettings-toggle-button"],SETTINGS_PANEL_CLOSE_BUTTON:'ms-run-settings button[iconname="close"]',MODEL_SELECTOR_CARD:"button.model-selector-card",MODEL_CATEGORIES_ALL_BUTTON:"button[data-test-category-button]",MODEL_CAROUSEL_BUTTON:"ms-model-carousel-row button.content-button",MODEL_TITLE_TEXT:"span.model-title-text",SYSTEM_PROMPT_CARD:"button[data-test-system-instructions-card]",SYSTEM_PROMPT_TEXTAREA:"ms-system-instructions textarea",DIALOG_CLOSE_BUTTON:"mat-dialog-container button[data-test-close-button]",MODEL_DIALOG_CONTAINER:"mat-dialog-container",ADVANCED_SETTINGS_TOGGLE:"div.settings-item",THINKING_TOGGLE:'mat-slide-toggle[data-test-toggle="enable-thinking"] button',MANUAL_BUDGET_TOGGLE:'mat-slide-toggle[data-test-toggle="manual-budget"] button',BUDGET_INPUT:'div[data-test-id="user-setting-budget-animation-wrapper"] input',TOOLS_TOGGLE_SELECTOR:"div.settings-item",WEB_SEARCH_TOGGLE:'div[data-test-id="searchAsAToolTooltip"] button',URL_CONTEXT_TOGGLE:'div[data-test-id="browseAsAToolTooltip"] button'},C={SCREEN_WIDTH_BREAKPOINT_PX:960,LOG_PREVIEW_LENGTH:50};class ue{constructor(e){this.chatbot=e}async setModel(e){return console.log(`[AI Studio Settings] Setting model to: "${e}"`),this.chatbot.retryOperation(async()=>{const n=await O([T.MODEL_SELECTOR_CARD],"Model selector card",w(y),2),t=S(n,HTMLButtonElement,"Model selector card"),o=t.querySelector("span.title");if(o&&o.textContent?.trim()===e){console.log(`[AI Studio LOG] Model "${e}" is already selected. Skipping.`);return}t.click(),await _([T.MODEL_DIALOG_CONTAINER],w(3e3));let i=null;try{i=await O([T.MODEL_CATEGORIES_ALL_BUTTON],"Model categories all button",w(y),2)}catch(l){if((l instanceof Error?l.message:String(l)).includes("occluded")){console.log("[AI Studio LOG] Element found but occluded. Waiting longer and attempting click anyway..."),await new Promise(d=>setTimeout(d,b.PANEL_ANIMATION_MS));const m=document.querySelector(T.MODEL_CATEGORIES_ALL_BUTTON);if(m&&m.offsetParent!==null)i=m,console.log("[AI Studio LOG] Found element despite occlusion, will attempt click.");else throw l}else throw l}const r=S(i,HTMLButtonElement,"Model categories all button");r.scrollIntoView({behavior:"smooth",block:"center"}),await new Promise(l=>setTimeout(l,b.UI_STABILIZE_DELAY_MS)),r.click(),await new Promise(l=>setTimeout(l,b.UI_STABILIZE_DELAY_MS));const a=Array.from(document.querySelectorAll(T.MODEL_CAROUSEL_BUTTON)),c=a.find(l=>{const E=l.textContent?.trim()||"";return(l.querySelector(T.MODEL_TITLE_TEXT)?.textContent?.trim()||"")===e||E.startsWith(e)});if(c){if(c.offsetParent===null)throw this.chatbot.createErrorWithContext("setModel",`Model button for "${e}" is not visible`);c.click(),console.log(`[AI Studio LOG] Success: Clicked model button for "${e}".`),await new Promise(l=>setTimeout(l,b.PANEL_ANIMATION_MS))}else{const l=a.map(E=>E.querySelector(T.MODEL_TITLE_TEXT)?.textContent?.trim()||E.textContent?.trim()||"unknown").join(", ");throw this.chatbot.createErrorWithContext("setModel",`Model button for "${e}" not found.`,`AvailableModels=[${l}]`)}if(document.querySelector("mat-dialog-container"))try{const l=await O([T.DIALOG_CLOSE_BUTTON],"Dialog close button",w(2e3),0);S(l,HTMLButtonElement,"Dialog close button").click(),await new Promise(m=>setTimeout(m,b.PANEL_ANIMATION_MS))}catch{console.log("[AI Studio LOG] Model dialog seems to have closed automatically.")}},"setModel",2,300)}async setTemperature(e){console.log(`[AI Studio LOG] Setting Temperature to: ${e}`);try{const n=await v("h3","Temperature");if(!n)throw new Error("Could not find 'Temperature' label in settings panel.");const t=n.closest(".settings-item-column");if(!t)throw new Error("Could not find parent container for 'Temperature' label.");const o=t.querySelector("input[type=number]");if(!o)throw new Error("Found 'Temperature' label but could not find its input field.");if(o.offsetParent===null||o.disabled)throw new Error(`Input field for 'Temperature' is not actionable (visible: ${o.offsetParent!==null}, disabled: ${o.disabled})`);o.value=e.toString(),o.dispatchEvent(new Event("change",{bubbles:!0})),console.log(`[AI Studio LOG] Set Temperature to ${e} successfully.`)}catch(n){throw new Error(`Failed to set Temperature: ${n instanceof Error?n.message:String(n)}. LabelName=Temperature, Value=${e}`)}}async setTopP(e){console.log(`[AI Studio LOG] Setting Top-P to: ${e}`);const t=(await v("p","Advanced settings")).closest(T.ADVANCED_SETTINGS_TOGGLE);t&&!t.classList.contains("expanded")&&(t.click(),await new Promise(o=>setTimeout(o,b.PANEL_ANIMATION_MS)));try{const o=await v("h3","Top P");if(!o)throw new Error("Could not find 'Top P' label in settings panel.");const i=o.closest(".settings-item-column");if(!i)throw new Error("Could not find parent container for 'Top P' label.");const r=i.querySelector("input[type=number]");if(!r)throw new Error("Found 'Top P' label but could not find its input field.");if(r.offsetParent===null||r.disabled)throw new Error(`Input field for 'Top P' is not actionable (visible: ${r.offsetParent!==null}, disabled: ${r.disabled})`);r.value=e.toString(),r.dispatchEvent(new Event("change",{bubbles:!0})),console.log(`[AI Studio LOG] Set Top P to ${e} successfully.`)}catch(o){throw new Error(`Failed to set Top P: ${o instanceof Error?o.message:String(o)}. LabelName=Top P, Value=${e}`)}}async setThinkingBudget(e){console.log(`[AI Studio LOG] Configuring thinking budget. Provided value: ${e}`);const n=await _([T.THINKING_TOGGLE]),t=S(n,HTMLButtonElement,"Thinking toggle"),o=t.getAttribute("aria-checked")==="true";e!=null&&!o&&(t.click(),console.log('[AI Studio LOG] Enabled "thinking" feature.'),await new Promise(c=>setTimeout(c,b.PANEL_ANIMATION_MS)));const i=await _([T.MANUAL_BUDGET_TOGGLE]),r=S(i,HTMLButtonElement,"Manual budget toggle"),a=r.getAttribute("aria-checked")==="true";if(e!=null){a||(r.click(),console.log('[AI Studio LOG] Enabled "manual budget".'),await new Promise(E=>setTimeout(E,b.PANEL_ANIMATION_MS)));const c=await _([T.BUDGET_INPUT]),l=S(c,HTMLInputElement,"Budget input");l.value=e.toString(),l.dispatchEvent(new Event("input",{bubbles:!0})),console.log(`[AI Studio LOG] Success: Set budget input to ${e}.`)}else a&&(r.click(),console.log('[AI Studio LOG] Success: Disabled "manual budget" as no value was provided.'))}async setAdvancedOptions(e,n){if(console.log("[AI Studio LOG] Setting advanced options:",e),e.disableThinking!==void 0)if(n?.toLowerCase()==="gemini-2.5-pro")console.log('[AI Studio LOG] Skipping "disableThinking" toggle as it is not applicable for gemini-2.5-pro.');else{const o=await _([T.THINKING_TOGGLE]),i=S(o,HTMLButtonElement,"Thinking toggle"),r=i.getAttribute("aria-checked")==="true",a=!e.disableThinking;a!==r&&(i.click(),console.log(`[AI Studio LOG] Toggled thinking to: ${a?"enabled":"disabled"}`))}if(e.useWebSearch!==void 0||e.urlContext!==void 0){const o=(await v("p","Tools")).closest(T.TOOLS_TOGGLE_SELECTOR);if(o&&!o.classList.contains("expanded")&&(o.click(),await new Promise(i=>setTimeout(i,b.PANEL_ANIMATION_MS))),e.useWebSearch!==void 0){const i=await _([T.WEB_SEARCH_TOGGLE]),r=S(i,HTMLButtonElement,"Web search toggle");e.useWebSearch!==(r.getAttribute("aria-checked")==="true")&&(r.click(),console.log(`[AI Studio LOG] Toggled web search to: ${e.useWebSearch}`))}if(e.urlContext!==void 0){const i=await _([T.URL_CONTEXT_TOGGLE]),r=S(i,HTMLButtonElement,"URL context toggle");e.urlContext!==(r.getAttribute("aria-checked")==="true")&&(r.click(),console.log(`[AI Studio LOG] Toggled URL context to: ${e.urlContext}`))}}}}class q{constructor(){this.responseObserver=null,this.debounceTimer=null,this.settingsManager=new ue(this)}getPageStateContext(){const e=document.querySelectorAll("*").length;return`URL=${window.location.href}, ReadyState=${document.readyState}, VisibleElements=${e}`}createErrorWithContext(e,n,t){const o=this.getPageStateContext(),i=t?`${o}, ${t}`:o;return new Error(`${e} failed: ${n}
Context: ${i}`)}async retryOperation(e,n,t=2,o=300){let i=null;for(let r=0;r<=t;r++)try{return await e()}catch(a){if(i=a instanceof Error?a:new Error(String(a)),r>=t)throw this.createErrorWithContext(n,i.message,`Retries=${t}, Attempt=${r+1}`);const c=o*Math.pow(2,r);console.log(`[AI Studio LOG] ${n} failed, retrying ${r+1}/${t} after ${c}ms. Error: ${i.message.split(`
`)[0]}`),await new Promise(l=>setTimeout(l,c))}throw i||new Error(`${n} failed after ${t} retries`)}async resetState(){console.log("[AI Studio] Preparing to reset UI state...");try{const e=Array.isArray(T.SETTINGS_PANEL_MOBILE_TOGGLE)?T.SETTINGS_PANEL_MOBILE_TOGGLE[0]:T.SETTINGS_PANEL_MOBILE_TOGGLE,n=e?document.querySelector(e):null,t=document.querySelector(T.NEW_CHAT_BUTTON);if(!t||t.offsetParent===null){console.warn('[AI Studio] "New Chat" button not found, assuming clean state and proceeding.'),await this.waitForReady();return}if(t.click(),console.log('[AI Studio] "New Chat" clicked. Waiting for UI transition...'),n){const o=w(5e3),i=Date.now();for(;document.body.contains(n);){if(Date.now()-i>o)throw this.createErrorWithContext("resetState","Old settings button did not disappear within timeout.",`Timeout=${o}ms`);await new Promise(r=>setTimeout(r,50))}console.log("[AI Studio] Old UI elements have been removed.")}await this.waitForReady(),console.log("[AI Studio] State reset completed successfully.")}catch(e){console.error("[AI Studio] A non-critical error occurred during state reset. Continuing under assumption that UI is ready.",e),await this.waitForReady()}}async waitForReady(){await O(T.PROMPT_INPUTS,"Prompt Input Area"),console.log("[AI Studio] UI is fully actionable and ready (prompt input is available).")}async setSystemPrompt(e){if(e){console.log("[AI Studio LOG] Setting system prompt."),await this.openSettingsPanel();try{const n=await _([T.SYSTEM_PROMPT_CARD]);S(n,HTMLButtonElement,"System prompt card").click(),await new Promise(c=>setTimeout(c,b.PANEL_ANIMATION_MS));const o=await _([T.SYSTEM_PROMPT_TEXTAREA]),i=S(o,HTMLTextAreaElement,"System prompt textarea");i.value=e,i.dispatchEvent(new Event("input",{bubbles:!0})),console.log("[AI Studio LOG] Success: System prompt entered.");const r=await _([T.DIALOG_CLOSE_BUTTON]);S(r,HTMLButtonElement,"Dialog close button").click(),await new Promise(c=>setTimeout(c,b.PANEL_ANIMATION_MS))}finally{await this.closeSettingsPanel()}}}async applyAllSettings(e){if(!(e.model||e.temperature!==void 0||e.topP!==void 0||e.thinkingBudget!==void 0||e.useWebSearch!==void 0||e.disableThinking!==void 0||e.urlContext!==void 0)){console.log("[AI Studio LOG] No settings to apply. Skipping panel.");return}await this.openSettingsPanel();try{e.model&&await this.settingsManager.setModel(e.model),e.temperature!==void 0&&await this.settingsManager.setTemperature(e.temperature),e.topP!==void 0&&await this.settingsManager.setTopP(e.topP),e.thinkingBudget!==void 0&&await this.settingsManager.setThinkingBudget(e.thinkingBudget);const t={useWebSearch:e.useWebSearch,disableThinking:e.disableThinking,urlContext:e.urlContext};Object.values(t).some(o=>o!==void 0)&&await this.settingsManager.setAdvancedOptions(t,e.model)}finally{await this.closeSettingsPanel()}}async sendPrompt(e){if(console.log("[AI Studio LOG] Starting automation with prompt:",e.substring(0,C.LOG_PREVIEW_LENGTH)),this.isLoginPage())return console.log("[AI Studio LOG] Login page detected. Notifying Dart."),I({type:Y,location:"sendPrompt",payload:"User needs to sign in to Google Account"}),new Promise(()=>{});try{const n=await O(T.PROMPT_INPUTS,"Prompt input area",w(y),2);if(n instanceof HTMLTextAreaElement||n instanceof HTMLInputElement)n.value=e,n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0})),console.log("[AI Studio LOG] Prompt entered into input area, waiting for token count update...");else{const t=n?n.constructor.name:"null";throw this.createErrorWithContext("sendPrompt","Input area is not a valid textarea or input element.",`ElementType=${t}`)}return await new Promise((t,o)=>{const i=w(b.TOKEN_COUNT_UPDATE_TIMEOUT_MS),r=Date.now(),a=()=>{if(Date.now()-r>i){o(new Error(`Token count did not update within ${i}ms.`));return}const E=document.querySelector(T.TOKEN_COUNT)?.textContent?.trim();E&&!E.startsWith("0")?(console.log(`[AI Studio LOG] Token count updated: ${E}`),t()):setTimeout(a,b.TOKEN_COUNT_CHECK_INTERVAL_MS)};a()}),await new Promise(t=>setTimeout(t,b.UI_STABILIZE_AFTER_TOKEN_COUNT_MS)),console.log("[AI Studio LOG] UI stabilized after token count, proceeding to send."),await this.closeSettingsPanel(),this.retryOperation(async()=>{const t=await O(T.SEND_BUTTONS,"Send button",w(y),2);S(t,HTMLElement,"Send button").click(),console.log("[AI Studio LOG] Send button clicked successfully.")},"sendPrompt (click send button)",2,300)}catch(n){throw this.createErrorWithContext("sendPrompt",`Failed to send prompt: ${n instanceof Error?n.message:String(n)}`,`PromptLength=${e.length}`)}}findTurnContainerFromEditButton(e){const n=Array.isArray(T.CHAT_TURN)?T.CHAT_TURN.join(","):T.CHAT_TURN;return e.closest(n)}async extractResponse(){console.log(`[AI Studio LOG] Starting extraction process... (timeout: ${b.FINALIZED_TURN_TIMEOUT_MS}ms)`);const e=(r=b.FINALIZED_TURN_TIMEOUT_MS)=>new Promise((a,c)=>{const l=Array.isArray(T.EDIT_BUTTON)?T.EDIT_BUTTON.join(","):T.EDIT_BUTTON;let E=null,m=null;const d=()=>{E&&E.disconnect(),m&&clearTimeout(m)},f=()=>{const u=document.querySelectorAll(l);if(u.length===0)return;const g=u[u.length-1],p=this.findTurnContainerFromEditButton(g);p&&!p.querySelector('button[aria-label="Stop editing"]')&&g.offsetParent!==null&&!g.disabled&&(console.log("[AI Studio LOG] Found finalized turn via MutationObserver check."),d(),a({turn:p,editButton:g}))};E=new MutationObserver(f),E.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-label","disabled"]}),m=window.setTimeout(()=>{d();const g=`Extraction timed out. Final state: ${document.querySelectorAll(l).length} edit buttons found. The last response may still be generating or UI has changed.`;console.error(`[AI Studio LOG] ${g}`),c(new Error(g))},r),f()}),{turn:n,editButton:t}=await e();console.log("[AI Studio LOG] Finalized turn found, clicking edit button..."),t.click(),console.log("[AI Studio LOG] Waiting for textarea to appear...");const o=await x(n,T.EDIT_TEXTAREA,b.TEXTAREA_APPEAR_TIMEOUT_MS);console.log("[AI Studio LOG] Textarea appeared, waiting for UI to stabilize..."),await new Promise(r=>setTimeout(r,b.UI_STABILIZE_DELAY_MS));const i=(o.value??o.innerText??"").trim();if(!i){const r="Textarea was found but it was empty.";throw console.error(`[AI Studio LOG] ${r}`),this.createErrorWithContext("extractResponse",r,"Textarea was found but contained no content")}console.log(`[AI Studio LOG] Extracted ${i.length} chars successfully.`);try{const r=n.querySelector(T.STOP_EDITING_BUTTON);r&&(r.click(),console.log("[AI Studio LOG] Exited edit mode successfully."))}catch(r){console.warn("[AI Studio LOG] Could not exit edit mode, but extraction was successful. This is non-critical.",r)}return i}async startResponseObserver(){this.responseObserver&&this.stopResponseObserver();const e=document.querySelector("ms-chat-session")??document.body;this.responseObserver=new MutationObserver(n=>{n.filter(o=>this.shouldProcessMutation(o)).length>0&&this.checkUIState()}),this.responseObserver.observe(e,{childList:!0,subtree:!0}),console.log("[AI Studio] Started observing DOM for new responses.")}stopResponseObserver(){this.responseObserver&&(this.responseObserver.disconnect(),this.responseObserver=null),this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null)}shouldProcessMutation(e){if(e.type!=="childList"||e.addedNodes.length===0)return!1;for(let n=0;n<e.addedNodes.length;n++){const t=e.addedNodes[n];if(t&&t.nodeType===Node.ELEMENT_NODE){const o=t;if(o.tagName==="BUTTON"||o.querySelector("button"))return!0}}return!1}checkUIState(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>{const e=document.querySelector(".model-error mat-icon");if(e&&e.textContent?.trim()==="error"&&!window.__hasAttemptedRetry){window.__hasAttemptedRetry=!0,console.warn("[AI Studio] Detected transient model error. Requesting retry from Dart."),I({type:X}),this.stopResponseObserver();return}const n='[id^="turn-"], ms-chat-turn',t='button[aria-label="Edit"]',o=document.querySelectorAll(n);if(o.length===0)return;const i=o[o.length-1],r=i.querySelector(t);if(!r)return;const c=Array.from(i.querySelectorAll('textarea, [contenteditable="true"]')).filter(m=>m.closest("ms-chunk-input")===null).length===0,l=r.offsetParent!==null,E=!r.disabled&&!r.hasAttribute("inert");c&&l&&E&&(console.log("[AI Studio] Detected finalized response in the last chat turn. Notifying Dart that UI is ready for refinement."),I({type:$}),this.stopResponseObserver())},b.UI_STATE_DEBOUNCE_DELAY_MS)}isLoginPage(){const e=window.location.href.toLowerCase();if(e.includes("accounts.google.com")||e.includes("/signin"))return!0;const n=document.querySelector('input[type="email"]'),t=document.body?.innerText?.includes("Sign in");return n&&t?(console.log("[AI Studio] Login page detected via DOM elements"),!0):!1}async openSettingsPanel(){if(window.innerWidth<=C.SCREEN_WIDTH_BREAKPOINT_PX){if(document.querySelector(T.SETTINGS_PANEL_CLOSE_BUTTON)){console.log("[AI Studio LOG] Settings panel is already open.");return}try{const e=await O(Array.isArray(T.SETTINGS_PANEL_MOBILE_TOGGLE)?T.SETTINGS_PANEL_MOBILE_TOGGLE:[T.SETTINGS_PANEL_MOBILE_TOGGLE],"Settings panel toggle button",w(y),2);S(e,HTMLButtonElement,"Settings panel toggle button").click(),await new Promise(o=>setTimeout(o,b.PANEL_ANIMATION_MS)),document.querySelector(T.SETTINGS_PANEL_CLOSE_BUTTON)||(console.warn("[AI Studio LOG] Settings panel may not have opened properly. Retrying..."),await new Promise(o=>setTimeout(o,b.PANEL_ANIMATION_MS))),console.log("[AI Studio LOG] Settings panel opened successfully.")}catch(e){throw this.createErrorWithContext("openSettingsPanel",`Failed to open settings panel: ${e instanceof Error?e.message:String(e)}`)}}}async closeSettingsPanel(){if(window.innerWidth<=C.SCREEN_WIDTH_BREAKPOINT_PX){if(!document.querySelector(T.SETTINGS_PANEL_CLOSE_BUTTON)){console.log("[AI Studio LOG] Settings panel appears to be already closed.");return}try{const e=await O([T.SETTINGS_PANEL_CLOSE_BUTTON],"Settings panel close button",w(2e3),0);S(e,HTMLButtonElement,"Settings panel close button").click(),await new Promise(t=>setTimeout(t,b.PANEL_ANIMATION_MS)),console.log("[AI Studio LOG] Settings panel closed successfully.")}catch(e){console.warn("[AI Studio LOG] Could not close settings panel, but continuing:",e)}}}}new q;const h={LOGIN_BUTTON:"button.login-button",PROMPT_INPUT:"div[contenteditable=true]",SEND_BUTTON_CONTAINER:".send-button-container",SEND_BUTTON:"div.send-button",GENERATING_INDICATOR:'path[d="M331.946667 379.904c-11.946667 23.466667-11.946667 54.186667-11.946667 115.626667v32.938666c0 61.44 0 92.16 11.946667 115.626667 10.538667 20.650667 27.306667 37.418667 47.957333 47.957333 23.466667 11.946667 54.186667 11.946667 115.626667 11.946667h32.938666c61.44 0 92.16 0 115.626667-11.946667 20.650667-10.538667 37.418667-27.306667 47.957333-47.957333 11.946667-23.466667 11.946667-54.186667 11.946667-115.626667v-32.938666c0-61.44 0-92.16-11.946667-115.626667a109.696 109.696 0 0 0-47.957333-47.957333c-23.466667-11.946667-54.186667-11.946667-115.626667-11.946667h-32.938666c-61.44 0-92.16 0-115.626667 11.946667-20.650667 10.538667-37.418667 27.306667-47.957333 47.957333z"]',RESPONSE_CONTAINER:".segment-content",RESPONSE_TEXT:".segment-content > div:first-child",COPY_BUTTON:".segment-assistant-actions-content div[data-v-10d40aa8]"};class de{constructor(){this.responseObserver=null,this.debounceTimer=null}async waitForReady(){console.log("[Kimi] Starting robust multi-condition readiness check...");const e=w(2e4);return new Promise((n,t)=>{let i=0,r=!1,a=!1;const c=()=>{const m=document.querySelector(h.LOGIN_BUTTON),d=!m;if(m&&!r){r=!0,console.log("[Kimi] Login button detected. Waiting 1.5s for page to stabilize..."),setTimeout(()=>{a=!0,console.log("[Kimi] Login button wait complete. Resuming readiness check...")},1500);return}if(r&&!a)return;const f=document.querySelector(h.PROMPT_INPUT),u=f&&f.offsetParent!==null,g=document.querySelector(h.SEND_BUTTON_CONTAINER),p=g&&g.offsetParent!==null;if(d&&u&&p)clearInterval(l),clearTimeout(E),console.log("[Kimi] All readiness conditions met. UI is ready."),n();else if(i+=250,i>=e){clearInterval(l),clearTimeout(E);const A=[`- Logged In: ${d}`,`- Prompt Input Ready: ${u}`,`- Send Container Ready: ${p}`].join(`
`);t(new Error(`[Kimi] UI readiness check timed out after ${e}ms.
Status:
${A}`))}},l=setInterval(c,250),E=setTimeout(()=>{clearInterval(l),t(new Error(`[Kimi] Readiness check timed out externally after ${e}ms.`))},e);c()})}async sendPrompt(e){console.log("[Kimi] Starting sendPrompt workflow...");const n=await O([h.PROMPT_INPUT],"Prompt Input");console.log("[Kimi] Dispatching InputEvent to contenteditable div..."),n.dispatchEvent(new InputEvent("input",{bubbles:!0,cancelable:!0,inputType:"insertText",data:e})),console.log("[Kimi] Waiting for send button to become enabled..."),await new Promise((o,i)=>{const r=w(5e3),a=100;let c=0;const E=setInterval(()=>{const m=document.querySelector(h.SEND_BUTTON_CONTAINER);m&&!m.classList.contains("disabled")?(clearInterval(E),console.log("[Kimi] Send button is now enabled."),o()):(c+=a,c>=r&&(clearInterval(E),i(new Error("Send button did not become enabled in time."))))},a)});const t=await O([h.SEND_BUTTON],"Send Button");console.log("[Kimi] Clicking send button..."),t.click(),console.log("[Kimi] Send button clicked successfully.")}stopResponseObserver(){this.responseObserver&&(this.responseObserver.disconnect(),this.responseObserver=null),this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),console.log("[Kimi Observer] Stopped observing.")}checkForFinalizedResponse(){const e=document.querySelectorAll(h.RESPONSE_CONTAINER);if(e.length===0)return;const n=e[e.length-1];if(!n)return;const t=!!document.querySelector(h.GENERATING_INDICATOR),o=n.querySelector(h.COPY_BUTTON);!t&&o&&(console.log("[Kimi Observer] Detected finalized response. Notifying Dart."),I({type:$}),this.stopResponseObserver())}async startResponseObserver(){this.stopResponseObserver();const e=document.body;this.responseObserver=new MutationObserver(()=>{this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>this.checkForFinalizedResponse(),300)}),this.responseObserver.observe(e,{childList:!0,subtree:!0}),console.log("[Kimi Observer] Started observing DOM for new responses.")}async extractResponse(){console.log("[Kimi] Starting response extraction workflow...");const e=document.querySelectorAll(h.RESPONSE_CONTAINER);if(e.length===0)throw new Error("No response containers found.");const n=e[e.length-1];if(!n)throw new Error("Could not find last response container.");const t=u=>u.replace(/\s+Copy\s*$/i,"").replace(/\u00a0/g," ").replace(/[ \t]+\n/g,`
`).replace(/\n{3,}/g,`

`).trim(),o=n.querySelector(h.RESPONSE_TEXT);if(o){const u=t(o.innerText);if(u.length>0)return console.log(`[Kimi] Extracted response text directly from DOM (${u.length} chars).`),u}const i=t(n.innerText??"");if(i.length>0)return console.log(`[Kimi] Extracted response from container fallback (${i.length} chars).`),i;if(!window.flutter_inappwebview)throw new Error("flutter_inappwebview bridge is not available for clipboard operations.");console.log("[Kimi] Falling back to clipboard-based extraction workflow...");const r=`ai-hybrid-hub-copy-check-${Date.now()}`;try{await window.flutter_inappwebview.callHandler("setClipboard",r),console.log("[Kimi] Primed clipboard with unique token.")}catch(u){throw console.error("[Kimi] Failed to prime clipboard via Dart handler.",u),new Error("Could not set initial clipboard state for validation.")}const a=await x(n,[h.COPY_BUTTON],w(5e3));if(!a.offsetParent)throw new Error("Copy button is not visible.");a.scrollIntoView({behavior:"smooth",block:"center"}),await new Promise(u=>setTimeout(u,200));const c=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,view:window}),l=new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,view:window}),E=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});a.dispatchEvent(c),await new Promise(u=>setTimeout(u,50)),a.dispatchEvent(l),await new Promise(u=>setTimeout(u,50)),a.dispatchEvent(E),console.log('[Kimi] "Copy" button clicked with full mouse event sequence. Waiting before polling...'),await new Promise(u=>setTimeout(u,300));const m=150,d=40;for(let u=0;u<d;u++){await new Promise(g=>setTimeout(g,m));try{const g=await window.flutter_inappwebview.callHandler("readClipboard");if(typeof g=="string"&&g.trim()&&g!==r)return console.log(`[Kimi] Clipboard updated. Successfully extracted ${g.length} chars (attempt ${u+1}).`),g}catch(g){console.warn(`[Kimi] Clipboard read attempt ${u+1} failed, retrying...`,g)}}let f="";try{const u=await window.flutter_inappwebview.callHandler("readClipboard");f=` Final clipboard state: ${typeof u=="string"?`"${u.substring(0,50)}..."`:"non-string"}`}catch(u){f=` Could not read final clipboard state: ${u}`}throw new Error(`Extraction failed: Clipboard content did not change from the unique token after the copy operation.${f} Tried ${d} times over ${d*m/1e3}s.`)}}const Ee=new de,Te=100,me=300,ge=0,fe=100;function W(){if(window.flutter_inappwebview&&typeof window.flutter_inappwebview.callHandler=="function")try{window.flutter_inappwebview.callHandler(V),console.log("[Engine] Bridge ready signal sent to Flutter.")}catch(s){console.warn("[Engine] Failed to send bridge ready signal:",s)}}document.addEventListener("flutterInAppWebViewPlatformReady",()=>{console.log("[Engine] Received flutterInAppWebViewPlatformReady event"),W()});function D(s=Te,e=me){if(s<=0){console.warn("[Engine] Max retries reached for bridge ready signal.");return}window.flutter_inappwebview&&typeof window.flutter_inappwebview.callHandler=="function"?W():setTimeout(()=>D(s-1,e),e)}if(window.__AI_HYBRID_HUB_INITIALIZED__&&(console.log("[Engine] Bridge script already initialized. Checking if functions exist..."),typeof window.startAutomation<"u"&&typeof window.extractFinalResponse<"u"&&typeof window.inspectDOMForSelectors<"u"?(console.log("[Engine] Functions exist, signaling ready."),D()):(console.warn("[Engine] Flag set but functions missing! Force re-initialization."),delete window.__AI_HYBRID_HUB_INITIALIZED__)),!window.__AI_HYBRID_HUB_INITIALIZED__){let s=function(o){const i=t[o];return i?(console.log(`[Engine] Matched providerId: "${o}". Using corresponding chatbot module.`),i):(console.error(`[Engine] No chatbot module found for providerId: "${o}"`),null)},e=function(o,i=document){try{const r=i.querySelector(o);if(r)return r;const a=i.querySelectorAll("*");for(const c of a)if(c.shadowRoot){const l=e(o,c.shadowRoot);if(l)return l}}catch{}return null};window.__AI_HYBRID_HUB_INITIALIZED__=!0,window.__processedFootersCount=ge;const n={currentChatbot:null},t={ai_studio:new q,kimi:Ee};window.startAutomation=async function(o){console.log("[Engine LOG] >>> Full automation cycle started by Dart. Options:",JSON.stringify(o,null,2)),window.__hasAttemptedRetry=!1,window.__AI_TIMEOUT_MODIFIER__=o.timeoutModifier??1,console.log(`[Engine] Using timeout modifier: ${window.__AI_TIMEOUT_MODIFIER__}x`);const i=s(o.providerId);if(!i){I({type:N,errorCode:"UNSUPPORTED_PROVIDER",payload:`Provider "${o.providerId}" is not supported.`});return}n.currentChatbot=i;const r=Date.now();let a="Initialization";try{i.resetState&&(a="Phase 1: Resetting UI state",console.log(`[Engine LOG] ${a}...`),await i.resetState()),a="Phase 2: Waiting for UI to be ready",console.log(`[Engine LOG] ${a}...`),await i.waitForReady(),a="Phase 3: Applying configurations",console.log(`[Engine LOG] ${a}...`),o.systemPrompt&&i.setSystemPrompt&&(console.log(`[Engine LOG] Setting system prompt (length: ${o.systemPrompt.length})`),await i.setSystemPrompt(o.systemPrompt)),i.applyAllSettings&&await i.applyAllSettings(o),a="Phase 4: Entering and sending prompt",console.log(`[Engine LOG] ${a}...`),await i.sendPrompt(o.prompt),a="Phase 5: Starting response observer",console.log(`[Engine LOG] ${a}...`),i.startResponseObserver&&await i.startResponseObserver();const c=Date.now()-r;console.log(`[Engine LOG] Full automation cycle initiated successfully in ${c}ms. Now observing for response.`)}catch(c){const l=c instanceof Error?c.message:String(c),E=Date.now()-r,m={url:window.location.href,readyState:document.readyState,visibleElements:document.querySelectorAll("*").length};console.error(`[Engine LOG] Full automation cycle failed in ${a} after ${E}ms!`,c);const d={phase:a,elapsedTimeMs:E,url:m.url,readyState:m.readyState,visibleElements:m.visibleElements,timestamp:new Date().toISOString()};throw(l.includes("Selector")||l.includes("selector"))&&(d.selectorContext="Error message contains selector information"),I({type:N,errorCode:"FULL_CYCLE_FAILED",location:"startAutomation",payload:l,diagnostics:d}),c}},window.extractFinalResponse=async function(){console.log("[Engine LOG] extractFinalResponse called");const o=n.currentChatbot;if(!o){const r="No chatbot available for extraction. Automation must be started first.";throw console.error("[Engine LOG] No chatbot found for extraction"),I({type:N,errorCode:"NO_CHATBOT_INSTANCE",payload:r}),new Error(r)}const i=Date.now();console.log(`[Engine LOG] Starting extraction with chatbot: ${o.constructor.name}`);try{console.log("[Engine LOG] [ENHANCED] DOM state before extraction:",{url:window.location.href,readyState:document.readyState,title:document.title,timestamp:new Date().toISOString()});const r=await o.extractResponse(),a=Date.now()-i;return console.log(`[Engine LOG] Extraction completed successfully in ${a}ms, extracted ${r.length} chars`),console.log("[Engine LOG] [ENHANCED] Extraction result details:",{success:!0,resultLength:r.length,resultPreview:r.substring(0,100)+(r.length>100?"...":""),elapsedTime:a}),r}catch(r){const a=r instanceof Error?r.message:String(r),c=Date.now()-i;console.error("[Engine LOG] [ENHANCED] Extraction failed with details:",{success:!1,errorMessage:a,errorType:r instanceof Error?r.constructor.name:typeof r,elapsedTime:c,timestamp:new Date().toISOString(),domState:{url:window.location.href,readyState:document.readyState,title:document.title,editButtons:document.querySelectorAll('button[aria-label="Edit"]').length,textareas:document.querySelectorAll('textarea, [contenteditable="true"]').length}});const l=`Extraction failed: ${a} (Type: ${r instanceof Error?r.constructor.name:typeof r}, Time: ${c}ms)`;throw console.error(`[Engine LOG] ${l}`),I({type:N,errorCode:"EXTRACTION_FAILED",payload:l}),r}},window.inspectDOMForSelectors=function(){const o={inputs:[],buttons:[],allSelectorsTested:{},shadowDOMDetected:!1},i=document.querySelectorAll("*");for(const d of i)if(d.shadowRoot){o.shadowDOMDetected=!0;break}const r=["textarea[placeholder*='prompt']","input[placeholder*='prompt']","textarea","input[type='text']"],a={};for(const d of r)try{a[d]=document.querySelector(d),a[d]||(a[`${d} (shadow)`]=e(d))}catch{a[d]=null}o.allSelectorsTested.promptInput=a;const c=['button[aria-label*="Run"]','button[aria-label*="Send"]','button[type="submit"]',"button"],l={};for(const d of c)try{l[d]=document.querySelector(d),l[d]||(l[`${d} (shadow)`]=e(d))}catch{l[d]=null}o.allSelectorsTested.sendButton=l;const E=Array.from(document.querySelectorAll('input, textarea, [contenteditable="true"]'));o.inputs=E.map(d=>{const f=d;return{tag:d.tagName.toLowerCase(),type:f.getAttribute("type")||"",placeholder:f.getAttribute("placeholder")||"",ariaLabel:f.getAttribute("aria-label")||"",id:d.id||"",className:d.className||"",contentEditable:f.contentEditable,visible:f.offsetParent!==null,inShadowDOM:!1}});const m=Array.from(document.querySelectorAll("button"));return o.buttons=m.map(d=>{const f=d;return{tag:d.tagName.toLowerCase(),ariaLabel:f.getAttribute("aria-label")||"",text:(f.innerText||"").substring(0,fe),id:d.id||"",className:d.className||"",type:f.getAttribute("type")||"",visible:f.offsetParent!==null,inShadowDOM:!1}}),o},console.log("[Engine] Bridge script injected. Waiting for flutter_inappwebview..."),D()}})();
