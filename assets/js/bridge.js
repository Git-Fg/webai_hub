(function(){"use strict";const K="automationBridge",V="bridgeReady",$="NEW_RESPONSE_DETECTED",Y="LOGIN_REQUIRED",N="AUTOMATION_FAILED",X="AUTOMATION_RETRY_REQUIRED";function I(s){const e=window;e.flutter_inappwebview&&e.flutter_inappwebview.callHandler(K,s)}function w(s){const e=window.__AI_TIMEOUT_MODIFIER__??1;return s*e}const M=1e4,G=300,P=2,z=300,Z=2e3;function j(){return{url:window.location.href,readyState:document.readyState,visibleElementsCount:document.querySelectorAll("*").length}}function B(s,e,o,t="waitForElement"){const n=j();return`${t} failed: None of the selectors [${s.join(", ")}] found within ${e}ms
Context: URL=${n.url}, Timeout=${e}ms, Elapsed=${o}ms
Page State: Ready=${n.readyState}, VisibleElements=${n.visibleElementsCount}`}function U(s,e,o){for(let t=0;t<s.length;t++){const n=s[t];if(!n)continue;let i=null;try{e?i=e.querySelector(n):i=document.querySelector(n)}catch(r){console.warn(`[${o}] Invalid selector "${n}" (index ${t}):`,r);continue}if(i)return i}return null}async function k(s,e,o="waitForElement",t){return new Promise((n,i)=>{const r=Date.now();let a=0,c=null,l=null,E=null,d=!1;console.log(`[${o}] Starting search for selectors: [${s.join(", ")}] (timeout: ${e}ms)`);const u=()=>{c&&(c.disconnect(),c=null),l!==null&&(clearTimeout(l),l=null),E!==null&&(clearInterval(E),E=null)},m=()=>{const g=Date.now()-r;g-a>=Z&&(console.log(`[${o}] Still searching... (elapsed: ${g}ms, remaining: ${e-g}ms)`),a=g),d||(U(s,t,o)||console.log(`[${o}] Selectors not found on first attempt`),d=!0);const f=U(s,t,o);if(f){const h=Date.now()-r,A=s.find(L=>{if(!L)return!1;try{return t?t.querySelector(L)===f:document.querySelector(L)===f}catch{return!1}});console.log(`[${o}] Found element with selector "${A||"unknown"}" after ${h}ms`),u(),n(f);return}if(g>=e){u();const h=B(s,e,g,o);i(new Error(h))}};if(typeof MutationObserver<"u"){c=new MutationObserver(()=>{m()});const g=t||document.body;c.observe(g,{childList:!0,subtree:!0}),m()}else console.warn(`[${o}] MutationObserver not available, using polling fallback`),E=window.setInterval(m,G),m();l=window.setTimeout(()=>{u();const g=Date.now()-r,f=B(s,e,g,o);i(new Error(f))},e)})}function _(s,e=M,o=P){const t=w(e);return R(()=>k(s,t,"waitForElement"),o,"waitForElement")}function x(s,e,o=M,t=P){const n=w(o);return R(()=>k(e,n,"waitForElementWithin",s),t,"waitForElementWithin")}function v(s,e,o=M,t=P){const n=w(o);return R(()=>Q(s,e,n),t,"waitForElementByText")}async function Q(s,e,o){return new Promise((t,n)=>{const i=Date.now();let r=null,a=null;const c=()=>{r&&(r.disconnect(),r=null),a!==null&&(clearTimeout(a),a=null)},l=()=>{const E=document.querySelectorAll(s);for(const u of E)if(u.textContent?.includes(e)){const m=Date.now()-i;console.log(`[waitForElementByText] Found element with text "${e}" after ${m}ms`),c(),t(u);return}Date.now()-i>=o&&(c(),n(new Error(`Element with selector "${s}" containing text "${e}" not found within ${o}ms`)))};if(typeof MutationObserver<"u")r=new MutationObserver(()=>{l()}),r.observe(document.body,{childList:!0,subtree:!0}),l();else{console.warn("[waitForElementByText] MutationObserver not available, using polling fallback");const E=window.setInterval(l,G);l(),a=window.setTimeout(()=>{clearInterval(E),c(),n(new Error(`Element with selector "${s}" containing text "${e}" not found within ${o}ms`))},o)}})}async function R(s,e,o){let t=null;for(let n=0;n<=e;n++)try{return await s()}catch(i){if(t=i instanceof Error?i:new Error(String(i)),!(t.message.includes("not found")||t.message.includes("timeout")||t.message.includes("None of the selectors"))||n>=e)throw t;const a=z*Math.pow(2,n);console.log(`[${o}] Retry ${n+1}/${e} after ${a}ms delay. Error: ${t.message.split(`
`)[0]}`),await new Promise(c=>setTimeout(c,a))}throw t||new Error(`Operation ${o} failed after ${e} retries`)}const J=1e4,ee=2,F=1e3,te=2e3;function ne(s){return s.isConnected===!0}function oe(s){if(typeof s.checkVisibility=="function")try{return s.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0})}catch{}return s.offsetParent!==null}async function ie(s,e=F){try{const o=s.getAnimations();if(o.length===0)return!0;const t=o.map(i=>i.finished);return await Promise.race([Promise.all(t),new Promise(i=>setTimeout(i,e))]),s.getAnimations().length===0}catch{return!0}}function re(s){if(s.disabled===!0||s.getAttribute("aria-disabled")==="true"||s.hasAttribute("inert"))return!1;let o=s.parentElement;for(;o;){if(o.hasAttribute("inert"))return!1;o=o.parentElement}return!0}function se(s){try{const e=s.getBoundingClientRect(),o=e.left+e.width/2,t=e.top+e.height/2,n=document.elementFromPoint(o,t);return n?s.contains(n)||n===s:!1}catch{return!0}}async function H(s,e=F){const o=s,t={attached:!1,visible:!1,stable:!1,enabled:!1,unoccluded:!1,details:{}};if(t.attached=ne(s),t.details.isConnected=s.isConnected,!t.attached)return{actionable:!1,diagnostics:t};t.visible=oe(o);try{typeof o.checkVisibility=="function"&&(t.details.checkVisibilityResult=o.checkVisibility({checkOpacity:!0,checkVisibilityCSS:!0}))}catch{}if(t.details.offsetParent=o.offsetParent,!t.visible)return{actionable:!1,diagnostics:t};t.stable=await ie(o,e);try{const i=o.getAnimations();t.details.animationsCount=i.length}catch{}if(!t.stable)return{actionable:!1,diagnostics:t};if(t.enabled=re(o),t.details.disabled=o.disabled,t.details.ariaDisabled=o.getAttribute("aria-disabled"),t.details.inert=o.hasAttribute("inert"),!t.enabled)return{actionable:!1,diagnostics:t};if(t.unoccluded=se(o),!t.unoccluded)try{const i=o.getBoundingClientRect(),r=i.left+i.width/2,a=i.top+i.height/2;t.details.occludingElement=document.elementFromPoint(r,a)}catch{}return{actionable:t.attached&&t.visible&&t.stable&&t.enabled&&t.unoccluded,diagnostics:t}}function ae(s,e,o,t="element"){const n=[];o.attached||n.push("not attached to DOM"),o.visible||n.push("not visible"),o.stable||n.push("has ongoing animations"),o.enabled||n.push("disabled or inert"),o.unoccluded||n.push("occluded by another element");const i={url:window.location.href,readyState:document.readyState,visibleElements:document.querySelectorAll("*").length};return`${t} is not actionable: ${n.join(", ")}
Selectors: [${s.join(", ")}]
Timeout: ${e}ms
Diagnostics: ${JSON.stringify(o.details,null,2)}
Page State: URL=${i.url}, ReadyState=${i.readyState}, VisibleElements=${i.visibleElements}`}async function le(s,e,o,t){const n=Date.now();let i=0;return console.log(`[waitForActionableElement] Starting search for actionable ${e} with selectors: [${s.join(", ")}] (timeout: ${o}ms)`),new Promise((r,a)=>{let c=null,l=null,E=null;const d=()=>{c&&(c.disconnect(),c=null),l!==null&&(clearTimeout(l),l=null),E!==null&&(clearInterval(E),E=null)},u=async()=>{const m=Date.now()-n;m-i>=te&&(console.log(`[waitForActionableElement] Still checking actionability for ${e}... (elapsed: ${m}ms)`),i=m);for(const g of s){if(!g)continue;let f=null;try{t||(f=document.querySelector(g))}catch(h){console.warn(`[waitForActionableElement] Invalid selector "${g}":`,h);continue}if(f){const{actionable:h,diagnostics:A}=await H(f);if(h){const L=Date.now()-n;console.log(`[waitForActionableElement] Found actionable ${e} with selector "${g}" after ${L}ms`),d(),r(f);return}else console.log(`[waitForActionableElement] Element found but not actionable: ${JSON.stringify(A.details)}`)}}if(m>=o){d();let g=null;for(const f of s)try{if(t||(g=document.querySelector(f)),g)break}catch{}if(g){const{diagnostics:f}=await H(g);a(new Error(ae(s,o,f,e)))}else a(new Error(`waitForActionableElement failed: None of the selectors [${s.join(", ")}] found within ${o}ms`))}};if(typeof MutationObserver<"u"){c=new MutationObserver(()=>{u()});const m=document.body;c.observe(m,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["disabled","aria-disabled","inert","style","class"]}),u()}else console.warn("[waitForActionableElement] MutationObserver not available, using polling fallback"),E=window.setInterval(u,100),u();l=window.setTimeout(()=>{d(),u()},o)})}function O(s,e="element",o=J,t=ee){const n=w(o);return ce(()=>le(s,e,n),t,`waitForActionableElement(${e})`)}async function ce(s,e,o){let t=null;const n=300;for(let i=0;i<=e;i++)try{return await s()}catch(r){if(t=r instanceof Error?r:new Error(String(r)),!(t.message.includes("not found")||t.message.includes("timeout")||t.message.includes("None of the selectors")||t.message.includes("not actionable"))||i>=e)throw t;const c=n*Math.pow(2,i);console.log(`[${o}] Retry ${i+1}/${e} after ${c}ms delay. Error: ${t.message.split(`
`)[0]}`),await new Promise(l=>setTimeout(l,c))}throw t||new Error(`Operation ${o} failed after ${e} retries`)}function S(s,e,o="DOM assertion"){if(!s)throw new Error(`[${o}] Assertion failed: Expected ${e.name}, but the element is null.`);if(!(s instanceof e))throw new Error(`[${o}] Assertion failed: Expected ${e.name}, but got ${s.constructor.name}.`);return s}const y=1e4,b={READINESS_CHECK_INTERVAL_MS:100,TOKEN_COUNT_UPDATE_TIMEOUT_MS:1e4,TOKEN_COUNT_CHECK_INTERVAL_MS:100,UI_STABILIZE_AFTER_TOKEN_COUNT_MS:30,FINALIZED_TURN_TIMEOUT_MS:15e3,FINALIZED_TURN_CHECK_INTERVAL_MS:1e3,EDIT_BUTTON_WAIT_TIMEOUT_MS:2e3,TEXTAREA_APPEAR_TIMEOUT_MS:5e3,UI_STABILIZE_DELAY_MS:150,PANEL_ANIMATION_MS:250,POLL_INTERVAL_MS:100,POLL_TIMEOUT_MS:5e3,UI_STATE_DEBOUNCE_DELAY_MS:250},T={NEW_CHAT_BUTTON:'a[href="/prompts/new_chat"]',RUN_SETTINGS_TOGGLE_MOBILE:"button.runsettings-toggle-button",MODEL_SELECTOR_DESKTOP:"button.model-selector-card",PROMPT_INPUTS:["ms-chunk-input textarea","textarea[placeholder*='Start typing a prompt']","textarea[aria-label*='Start typing a prompt']"],SEND_BUTTONS:['ms-run-button > button[aria-label="Run"]','ms-run-button > button[type="submit"]','button[aria-label="Run"]',"ms-run-button > button"],TOKEN_COUNT:"span.v3-token-count-value",EDIT_BUTTON:['button[aria-label="Edit"]','button[aria-label*="edit" i]','button:has([aria-label*="edit" i])'],EDIT_TEXTAREA:["textarea",'div[contenteditable="true"]','[contenteditable="true"]'],STOP_EDITING_BUTTON:'button[aria-label="Stop editing"]',CHAT_TURN:['[id^="turn-"]',"ms-chat-turn"],SETTINGS_PANEL_MOBILE_TOGGLE:['button[aria-label="Toggle run settings panel"]',"button.runsettings-toggle-button"],SETTINGS_PANEL_CLOSE_BUTTON:'ms-run-settings button[iconname="close"]',MODEL_SELECTOR_CARD:"button.model-selector-card",MODEL_CATEGORIES_ALL_BUTTON:"button[data-test-category-button]",MODEL_CAROUSEL_BUTTON:"ms-model-carousel-row button.content-button",MODEL_TITLE_TEXT:"span.model-title-text",SYSTEM_PROMPT_CARD:"button[data-test-system-instructions-card]",SYSTEM_PROMPT_TEXTAREA:"ms-system-instructions textarea",DIALOG_CLOSE_BUTTON:"mat-dialog-container button[data-test-close-button]",MODEL_DIALOG_CONTAINER:"mat-dialog-container",ADVANCED_SETTINGS_TOGGLE:"div.settings-item",THINKING_TOGGLE:'mat-slide-toggle[data-test-toggle="enable-thinking"] button',MANUAL_BUDGET_TOGGLE:'mat-slide-toggle[data-test-toggle="manual-budget"] button',BUDGET_INPUT:'div[data-test-id="user-setting-budget-animation-wrapper"] input',TOOLS_TOGGLE_SELECTOR:"div.settings-item",WEB_SEARCH_TOGGLE:'div[data-test-id="searchAsAToolTooltip"] button',URL_CONTEXT_TOGGLE:'div[data-test-id="browseAsAToolTooltip"] button'},C={SCREEN_WIDTH_BREAKPOINT_PX:960,LOG_PREVIEW_LENGTH:50};class ue{constructor(e){this.chatbot=e}async setModel(e){return console.log(`[AI Studio Settings] Setting model to: "${e}"`),this.chatbot.retryOperation(async()=>{const o=await O([T.MODEL_SELECTOR_CARD],"Model selector card",w(y),2),t=S(o,HTMLButtonElement,"Model selector card"),n=t.querySelector("span.title");if(n&&n.textContent?.trim()===e){console.log(`[AI Studio LOG] Model "${e}" is already selected. Skipping.`);return}t.click(),await _([T.MODEL_DIALOG_CONTAINER],w(3e3));let i=null;try{i=await O([T.MODEL_CATEGORIES_ALL_BUTTON],"Model categories all button",w(y),2)}catch(l){if((l instanceof Error?l.message:String(l)).includes("occluded")){console.log("[AI Studio LOG] Element found but occluded. Waiting longer and attempting click anyway..."),await new Promise(u=>setTimeout(u,b.PANEL_ANIMATION_MS));const d=document.querySelector(T.MODEL_CATEGORIES_ALL_BUTTON);if(d&&d.offsetParent!==null)i=d,console.log("[AI Studio LOG] Found element despite occlusion, will attempt click.");else throw l}else throw l}const r=S(i,HTMLButtonElement,"Model categories all button");r.scrollIntoView({behavior:"smooth",block:"center"}),await new Promise(l=>setTimeout(l,b.UI_STABILIZE_DELAY_MS)),r.click(),await new Promise(l=>setTimeout(l,b.UI_STABILIZE_DELAY_MS));const a=Array.from(document.querySelectorAll(T.MODEL_CAROUSEL_BUTTON)),c=a.find(l=>{const E=l.textContent?.trim()||"";return(l.querySelector(T.MODEL_TITLE_TEXT)?.textContent?.trim()||"")===e||E.startsWith(e)});if(c){if(c.offsetParent===null)throw this.chatbot.createErrorWithContext("setModel",`Model button for "${e}" is not visible`);c.click(),console.log(`[AI Studio LOG] Success: Clicked model button for "${e}".`),await new Promise(l=>setTimeout(l,b.PANEL_ANIMATION_MS))}else{const l=a.map(E=>E.querySelector(T.MODEL_TITLE_TEXT)?.textContent?.trim()||E.textContent?.trim()||"unknown").join(", ");throw this.chatbot.createErrorWithContext("setModel",`Model button for "${e}" not found.`,`AvailableModels=[${l}]`)}if(document.querySelector("mat-dialog-container"))try{const l=await O([T.DIALOG_CLOSE_BUTTON],"Dialog close button",w(2e3),0);S(l,HTMLButtonElement,"Dialog close button").click(),await new Promise(d=>setTimeout(d,b.PANEL_ANIMATION_MS))}catch{console.log("[AI Studio LOG] Model dialog seems to have closed automatically.")}},"setModel",2,300)}async setTemperature(e){console.log(`[AI Studio LOG] Setting Temperature to: ${e}`);try{const o=await v("h3","Temperature");if(!o)throw new Error("Could not find 'Temperature' label in settings panel.");const t=o.closest(".settings-item-column");if(!t)throw new Error("Could not find parent container for 'Temperature' label.");const n=t.querySelector("input[type=number]");if(!n)throw new Error("Found 'Temperature' label but could not find its input field.");if(n.offsetParent===null||n.disabled)throw new Error(`Input field for 'Temperature' is not actionable (visible: ${n.offsetParent!==null}, disabled: ${n.disabled})`);n.value=e.toString(),n.dispatchEvent(new Event("change",{bubbles:!0})),console.log(`[AI Studio LOG] Set Temperature to ${e} successfully.`)}catch(o){throw new Error(`Failed to set Temperature: ${o instanceof Error?o.message:String(o)}. LabelName=Temperature, Value=${e}`)}}async setTopP(e){console.log(`[AI Studio LOG] Setting Top-P to: ${e}`);const t=(await v("p","Advanced settings")).closest(T.ADVANCED_SETTINGS_TOGGLE);t&&!t.classList.contains("expanded")&&(t.click(),await new Promise(n=>setTimeout(n,b.PANEL_ANIMATION_MS)));try{const n=await v("h3","Top P");if(!n)throw new Error("Could not find 'Top P' label in settings panel.");const i=n.closest(".settings-item-column");if(!i)throw new Error("Could not find parent container for 'Top P' label.");const r=i.querySelector("input[type=number]");if(!r)throw new Error("Found 'Top P' label but could not find its input field.");if(r.offsetParent===null||r.disabled)throw new Error(`Input field for 'Top P' is not actionable (visible: ${r.offsetParent!==null}, disabled: ${r.disabled})`);r.value=e.toString(),r.dispatchEvent(new Event("change",{bubbles:!0})),console.log(`[AI Studio LOG] Set Top P to ${e} successfully.`)}catch(n){throw new Error(`Failed to set Top P: ${n instanceof Error?n.message:String(n)}. LabelName=Top P, Value=${e}`)}}async setThinkingBudget(e){console.log(`[AI Studio LOG] Configuring thinking budget. Provided value: ${e}`);const o=await _([T.THINKING_TOGGLE]),t=S(o,HTMLButtonElement,"Thinking toggle"),n=t.getAttribute("aria-checked")==="true";e!=null&&!n&&(t.click(),console.log('[AI Studio LOG] Enabled "thinking" feature.'),await new Promise(c=>setTimeout(c,b.PANEL_ANIMATION_MS)));const i=await _([T.MANUAL_BUDGET_TOGGLE]),r=S(i,HTMLButtonElement,"Manual budget toggle"),a=r.getAttribute("aria-checked")==="true";if(e!=null){a||(r.click(),console.log('[AI Studio LOG] Enabled "manual budget".'),await new Promise(E=>setTimeout(E,b.PANEL_ANIMATION_MS)));const c=await _([T.BUDGET_INPUT]),l=S(c,HTMLInputElement,"Budget input");l.value=e.toString(),l.dispatchEvent(new Event("input",{bubbles:!0})),console.log(`[AI Studio LOG] Success: Set budget input to ${e}.`)}else a&&(r.click(),console.log('[AI Studio LOG] Success: Disabled "manual budget" as no value was provided.'))}async setAdvancedOptions(e,o){if(console.log("[AI Studio LOG] Setting advanced options:",e),e.disableThinking!==void 0)if(o?.toLowerCase()==="gemini-2.5-pro")console.log('[AI Studio LOG] Skipping "disableThinking" toggle as it is not applicable for gemini-2.5-pro.');else{const n=await _([T.THINKING_TOGGLE]),i=S(n,HTMLButtonElement,"Thinking toggle"),r=i.getAttribute("aria-checked")==="true",a=!e.disableThinking;a!==r&&(i.click(),console.log(`[AI Studio LOG] Toggled thinking to: ${a?"enabled":"disabled"}`))}if(e.useWebSearch!==void 0||e.urlContext!==void 0){const n=(await v("p","Tools")).closest(T.TOOLS_TOGGLE_SELECTOR);if(n&&!n.classList.contains("expanded")&&(n.click(),await new Promise(i=>setTimeout(i,b.PANEL_ANIMATION_MS))),e.useWebSearch!==void 0){const i=await _([T.WEB_SEARCH_TOGGLE]),r=S(i,HTMLButtonElement,"Web search toggle");e.useWebSearch!==(r.getAttribute("aria-checked")==="true")&&(r.click(),console.log(`[AI Studio LOG] Toggled web search to: ${e.useWebSearch}`))}if(e.urlContext!==void 0){const i=await _([T.URL_CONTEXT_TOGGLE]),r=S(i,HTMLButtonElement,"URL context toggle");e.urlContext!==(r.getAttribute("aria-checked")==="true")&&(r.click(),console.log(`[AI Studio LOG] Toggled URL context to: ${e.urlContext}`))}}}}class q{constructor(){this.responseObserver=null,this.debounceTimer=null,this.settingsManager=new ue(this)}getPageStateContext(){const e=document.querySelectorAll("*").length;return`URL=${window.location.href}, ReadyState=${document.readyState}, VisibleElements=${e}`}createErrorWithContext(e,o,t){const n=this.getPageStateContext(),i=t?`${n}, ${t}`:n;return new Error(`${e} failed: ${o}
Context: ${i}`)}async retryOperation(e,o,t=2,n=300){let i=null;for(let r=0;r<=t;r++)try{return await e()}catch(a){if(i=a instanceof Error?a:new Error(String(a)),r>=t)throw this.createErrorWithContext(o,i.message,`Retries=${t}, Attempt=${r+1}`);const c=n*Math.pow(2,r);console.log(`[AI Studio LOG] ${o} failed, retrying ${r+1}/${t} after ${c}ms. Error: ${i.message.split(`
`)[0]}`),await new Promise(l=>setTimeout(l,c))}throw i||new Error(`${o} failed after ${t} retries`)}async resetState(){console.log("[AI Studio] Preparing to reset UI state...");try{const e=Array.isArray(T.SETTINGS_PANEL_MOBILE_TOGGLE)?T.SETTINGS_PANEL_MOBILE_TOGGLE[0]:T.SETTINGS_PANEL_MOBILE_TOGGLE,o=e?document.querySelector(e):null,t=document.querySelector(T.NEW_CHAT_BUTTON);if(!t||t.offsetParent===null){console.warn('[AI Studio] "New Chat" button not found, assuming clean state and proceeding.'),await this.waitForReady();return}if(t.click(),console.log('[AI Studio] "New Chat" clicked. Waiting for UI transition...'),o){const n=w(5e3),i=Date.now();for(;document.body.contains(o);){if(Date.now()-i>n)throw this.createErrorWithContext("resetState","Old settings button did not disappear within timeout.",`Timeout=${n}ms`);await new Promise(r=>setTimeout(r,50))}console.log("[AI Studio] Old UI elements have been removed.")}await this.waitForReady(),console.log("[AI Studio] State reset completed successfully.")}catch(e){console.error("[AI Studio] A non-critical error occurred during state reset. Continuing under assumption that UI is ready.",e),await this.waitForReady()}}async waitForReady(){await O(T.PROMPT_INPUTS,"Prompt Input Area"),console.log("[AI Studio] UI is fully actionable and ready (prompt input is available).")}async setSystemPrompt(e){if(e){console.log("[AI Studio LOG] Setting system prompt."),await this.openSettingsPanel();try{const o=await _([T.SYSTEM_PROMPT_CARD]);S(o,HTMLButtonElement,"System prompt card").click(),await new Promise(c=>setTimeout(c,b.PANEL_ANIMATION_MS));const n=await _([T.SYSTEM_PROMPT_TEXTAREA]),i=S(n,HTMLTextAreaElement,"System prompt textarea");i.value=e,i.dispatchEvent(new Event("input",{bubbles:!0})),console.log("[AI Studio LOG] Success: System prompt entered.");const r=await _([T.DIALOG_CLOSE_BUTTON]);S(r,HTMLButtonElement,"Dialog close button").click(),await new Promise(c=>setTimeout(c,b.PANEL_ANIMATION_MS))}finally{await this.closeSettingsPanel()}}}async applyAllSettings(e){if(!(e.model||e.temperature!==void 0||e.topP!==void 0||e.thinkingBudget!==void 0||e.useWebSearch!==void 0||e.disableThinking!==void 0||e.urlContext!==void 0)){console.log("[AI Studio LOG] No settings to apply. Skipping panel.");return}await this.openSettingsPanel();try{e.model&&await this.settingsManager.setModel(e.model),e.temperature!==void 0&&await this.settingsManager.setTemperature(e.temperature),e.topP!==void 0&&await this.settingsManager.setTopP(e.topP),e.thinkingBudget!==void 0&&await this.settingsManager.setThinkingBudget(e.thinkingBudget);const t={useWebSearch:e.useWebSearch,disableThinking:e.disableThinking,urlContext:e.urlContext};Object.values(t).some(n=>n!==void 0)&&await this.settingsManager.setAdvancedOptions(t,e.model)}finally{await this.closeSettingsPanel()}}async sendPrompt(e){if(console.log("[AI Studio LOG] Starting automation with prompt:",e.substring(0,C.LOG_PREVIEW_LENGTH)),this.isLoginPage())return console.log("[AI Studio LOG] Login page detected. Notifying Dart."),I({type:Y,location:"sendPrompt",payload:"User needs to sign in to Google Account"}),new Promise(()=>{});try{const o=await O(T.PROMPT_INPUTS,"Prompt input area",w(y),2);if(o instanceof HTMLTextAreaElement||o instanceof HTMLInputElement)o.value=e,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})),console.log("[AI Studio LOG] Prompt entered into input area, waiting for token count update...");else{const t=o?o.constructor.name:"null";throw this.createErrorWithContext("sendPrompt","Input area is not a valid textarea or input element.",`ElementType=${t}`)}return await new Promise((t,n)=>{const i=w(b.TOKEN_COUNT_UPDATE_TIMEOUT_MS),r=Date.now(),a=()=>{if(Date.now()-r>i){n(new Error(`Token count did not update within ${i}ms.`));return}const E=document.querySelector(T.TOKEN_COUNT)?.textContent?.trim();E&&!E.startsWith("0")?(console.log(`[AI Studio LOG] Token count updated: ${E}`),t()):setTimeout(a,b.TOKEN_COUNT_CHECK_INTERVAL_MS)};a()}),await new Promise(t=>setTimeout(t,b.UI_STABILIZE_AFTER_TOKEN_COUNT_MS)),console.log("[AI Studio LOG] UI stabilized after token count, proceeding to send."),await this.closeSettingsPanel(),this.retryOperation(async()=>{const t=await O(T.SEND_BUTTONS,"Send button",w(y),2);S(t,HTMLElement,"Send button").click(),console.log("[AI Studio LOG] Send button clicked successfully.")},"sendPrompt (click send button)",2,300)}catch(o){throw this.createErrorWithContext("sendPrompt",`Failed to send prompt: ${o instanceof Error?o.message:String(o)}`,`PromptLength=${e.length}`)}}findTurnContainerFromEditButton(e){const o=Array.isArray(T.CHAT_TURN)?T.CHAT_TURN.join(","):T.CHAT_TURN;return e.closest(o)}async extractResponse(){console.log(`[AI Studio LOG] Starting extraction process... (timeout: ${b.FINALIZED_TURN_TIMEOUT_MS}ms)`);const e=(r=b.FINALIZED_TURN_TIMEOUT_MS)=>new Promise((a,c)=>{const l=Array.isArray(T.EDIT_BUTTON)?T.EDIT_BUTTON.join(","):T.EDIT_BUTTON;let E=null,d=null;const u=()=>{E&&E.disconnect(),d&&clearTimeout(d)},m=()=>{const g=document.querySelectorAll(l);if(g.length===0)return;const f=g[g.length-1],h=this.findTurnContainerFromEditButton(f);h&&!h.querySelector('button[aria-label="Stop editing"]')&&f.offsetParent!==null&&!f.disabled&&(console.log("[AI Studio LOG] Found finalized turn via MutationObserver check."),u(),a({turn:h,editButton:f}))};E=new MutationObserver(m),E.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-label","disabled"]}),d=window.setTimeout(()=>{u();const f=`Extraction timed out. Final state: ${document.querySelectorAll(l).length} edit buttons found. The last response may still be generating or UI has changed.`;console.error(`[AI Studio LOG] ${f}`),c(new Error(f))},r),m()}),{turn:o,editButton:t}=await e();console.log("[AI Studio LOG] Finalized turn found, clicking edit button..."),t.click(),console.log("[AI Studio LOG] Waiting for textarea to appear...");const n=await x(o,T.EDIT_TEXTAREA,b.TEXTAREA_APPEAR_TIMEOUT_MS);console.log("[AI Studio LOG] Textarea appeared, waiting for UI to stabilize..."),await new Promise(r=>setTimeout(r,b.UI_STABILIZE_DELAY_MS));const i=(n.value??n.innerText??"").trim();if(!i){const r="Textarea was found but it was empty.";throw console.error(`[AI Studio LOG] ${r}`),this.createErrorWithContext("extractResponse",r,"Textarea was found but contained no content")}console.log(`[AI Studio LOG] Extracted ${i.length} chars successfully.`);try{const r=o.querySelector(T.STOP_EDITING_BUTTON);r&&(r.click(),console.log("[AI Studio LOG] Exited edit mode successfully."))}catch(r){console.warn("[AI Studio LOG] Could not exit edit mode, but extraction was successful. This is non-critical.",r)}return i}async startResponseObserver(){this.responseObserver&&this.stopResponseObserver();const e=document.querySelector("ms-chat-session")??document.body;this.responseObserver=new MutationObserver(o=>{o.filter(n=>this.shouldProcessMutation(n)).length>0&&this.checkUIState()}),this.responseObserver.observe(e,{childList:!0,subtree:!0}),console.log("[AI Studio] Started observing DOM for new responses.")}stopResponseObserver(){this.responseObserver&&(this.responseObserver.disconnect(),this.responseObserver=null),this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null)}shouldProcessMutation(e){if(e.type!=="childList"||e.addedNodes.length===0)return!1;for(let o=0;o<e.addedNodes.length;o++){const t=e.addedNodes[o];if(t&&t.nodeType===Node.ELEMENT_NODE){const n=t;if(n.tagName==="BUTTON"||n.querySelector("button"))return!0}}return!1}checkUIState(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>{const e=document.querySelector(".model-error mat-icon");if(e&&e.textContent?.trim()==="error"&&!window.__hasAttemptedRetry){window.__hasAttemptedRetry=!0,console.warn("[AI Studio] Detected transient model error. Requesting retry from Dart."),I({type:X}),this.stopResponseObserver();return}const o='[id^="turn-"], ms-chat-turn',t='button[aria-label="Edit"]',n=document.querySelectorAll(o);if(n.length===0)return;const i=n[n.length-1],r=i.querySelector(t);if(!r)return;const c=Array.from(i.querySelectorAll('textarea, [contenteditable="true"]')).filter(d=>d.closest("ms-chunk-input")===null).length===0,l=r.offsetParent!==null,E=!r.disabled&&!r.hasAttribute("inert");c&&l&&E&&(console.log("[AI Studio] Detected finalized response in the last chat turn. Notifying Dart that UI is ready for refinement."),I({type:$}),this.stopResponseObserver())},b.UI_STATE_DEBOUNCE_DELAY_MS)}isLoginPage(){const e=window.location.href.toLowerCase();if(e.includes("accounts.google.com")||e.includes("/signin"))return!0;const o=document.querySelector('input[type="email"]'),t=document.body?.innerText?.includes("Sign in");return o&&t?(console.log("[AI Studio] Login page detected via DOM elements"),!0):!1}async openSettingsPanel(){if(window.innerWidth<=C.SCREEN_WIDTH_BREAKPOINT_PX){if(document.querySelector(T.SETTINGS_PANEL_CLOSE_BUTTON)){console.log("[AI Studio LOG] Settings panel is already open.");return}try{const e=await O(Array.isArray(T.SETTINGS_PANEL_MOBILE_TOGGLE)?T.SETTINGS_PANEL_MOBILE_TOGGLE:[T.SETTINGS_PANEL_MOBILE_TOGGLE],"Settings panel toggle button",w(y),2);S(e,HTMLButtonElement,"Settings panel toggle button").click(),await new Promise(n=>setTimeout(n,b.PANEL_ANIMATION_MS)),document.querySelector(T.SETTINGS_PANEL_CLOSE_BUTTON)||(console.warn("[AI Studio LOG] Settings panel may not have opened properly. Retrying..."),await new Promise(n=>setTimeout(n,b.PANEL_ANIMATION_MS))),console.log("[AI Studio LOG] Settings panel opened successfully.")}catch(e){throw this.createErrorWithContext("openSettingsPanel",`Failed to open settings panel: ${e instanceof Error?e.message:String(e)}`)}}}async closeSettingsPanel(){if(window.innerWidth<=C.SCREEN_WIDTH_BREAKPOINT_PX){if(!document.querySelector(T.SETTINGS_PANEL_CLOSE_BUTTON)){console.log("[AI Studio LOG] Settings panel appears to be already closed.");return}try{const e=await O([T.SETTINGS_PANEL_CLOSE_BUTTON],"Settings panel close button",w(2e3),0);S(e,HTMLButtonElement,"Settings panel close button").click(),await new Promise(t=>setTimeout(t,b.PANEL_ANIMATION_MS)),console.log("[AI Studio LOG] Settings panel closed successfully.")}catch(e){console.warn("[AI Studio LOG] Could not close settings panel, but continuing:",e)}}}}new q;const p={LOGIN_BUTTON:"button.login-button",PROMPT_INPUT:"div[contenteditable=true]",SEND_BUTTON_CONTAINER:".send-button-container",SEND_BUTTON:"div.send-button",GENERATING_INDICATOR:'path[d="M331.946667 379.904c-11.946667 23.466667-11.946667 54.186667-11.946667 115.626667v32.938666c0 61.44 0 92.16 11.946667 115.626667 10.538667 20.650667 27.306667 37.418667 47.957333 47.957333 23.466667 11.946667 54.186667 11.946667 115.626667 11.946667h32.938666c61.44 0 92.16 0 115.626667-11.946667 20.650667-10.538667 37.418667-27.306667 47.957333-47.957333 11.946667-23.466667 11.946667-54.186667 11.946667-115.626667v-32.938666c0-61.44 0-92.16-11.946667-115.626667a109.696 109.696 0 0 0-47.957333-47.957333c-23.466667-11.946667-54.186667-11.946667-115.626667-11.946667h-32.938666c-61.44 0-92.16 0-115.626667 11.946667-20.650667 10.538667-37.418667 27.306667-47.957333 47.957333z"]',RESPONSE_CONTAINER:".segment-content",COPY_BUTTON:".segment-assistant-actions-content div[data-v-10d40aa8]"};class de{constructor(){this.responseObserver=null,this.debounceTimer=null}async waitForReady(){console.log("[Kimi] Starting robust multi-condition readiness check...");const e=w(2e4);return new Promise((o,t)=>{let i=0,r=!1,a=!1;const c=()=>{const d=document.querySelector(p.LOGIN_BUTTON),u=!d;if(d&&!r){r=!0,console.log("[Kimi] Login button detected. Waiting 1.5s for page to stabilize..."),setTimeout(()=>{a=!0,console.log("[Kimi] Login button wait complete. Resuming readiness check...")},1500);return}if(r&&!a)return;const m=document.querySelector(p.PROMPT_INPUT),g=m&&m.offsetParent!==null,f=document.querySelector(p.SEND_BUTTON_CONTAINER),h=f&&f.offsetParent!==null;if(u&&g&&h)clearInterval(l),clearTimeout(E),console.log("[Kimi] All readiness conditions met. UI is ready."),o();else if(i+=250,i>=e){clearInterval(l),clearTimeout(E);const A=[`- Logged In: ${u}`,`- Prompt Input Ready: ${g}`,`- Send Container Ready: ${h}`].join(`
`);t(new Error(`[Kimi] UI readiness check timed out after ${e}ms.
Status:
${A}`))}},l=setInterval(c,250),E=setTimeout(()=>{clearInterval(l),t(new Error(`[Kimi] Readiness check timed out externally after ${e}ms.`))},e);c()})}async sendPrompt(e){console.log("[Kimi] Starting sendPrompt workflow...");const o=await O([p.PROMPT_INPUT],"Prompt Input");console.log("[Kimi] Dispatching InputEvent to contenteditable div..."),o.dispatchEvent(new InputEvent("input",{bubbles:!0,cancelable:!0,inputType:"insertText",data:e})),console.log("[Kimi] Waiting for send button to become enabled..."),await new Promise((n,i)=>{const r=w(5e3),a=100;let c=0;const E=setInterval(()=>{const d=document.querySelector(p.SEND_BUTTON_CONTAINER);d&&!d.classList.contains("disabled")?(clearInterval(E),console.log("[Kimi] Send button is now enabled."),n()):(c+=a,c>=r&&(clearInterval(E),i(new Error("Send button did not become enabled in time."))))},a)});const t=await O([p.SEND_BUTTON],"Send Button");console.log("[Kimi] Clicking send button..."),t.click(),console.log("[Kimi] Send button clicked successfully.")}stopResponseObserver(){this.responseObserver&&(this.responseObserver.disconnect(),this.responseObserver=null),this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),console.log("[Kimi Observer] Stopped observing.")}checkForFinalizedResponse(){const e=document.querySelectorAll(p.RESPONSE_CONTAINER);if(e.length===0)return;const o=e[e.length-1];if(!o)return;const t=!!document.querySelector(p.GENERATING_INDICATOR),n=o.querySelector(p.COPY_BUTTON);!t&&n&&(console.log("[Kimi Observer] Detected finalized response. Notifying Dart."),I({type:$}),this.stopResponseObserver())}async startResponseObserver(){this.stopResponseObserver();const e=document.body;this.responseObserver=new MutationObserver(()=>{this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>this.checkForFinalizedResponse(),300)}),this.responseObserver.observe(e,{childList:!0,subtree:!0}),console.log("[Kimi Observer] Started observing DOM for new responses.")}async extractResponse(){if(console.log("[Kimi] Starting robust clipboard extraction workflow..."),!window.flutter_inappwebview)throw new Error("flutter_inappwebview bridge is not available for clipboard operations.");const e=`ai-hybrid-hub-copy-check-${Date.now()}`;try{await window.flutter_inappwebview.callHandler("setClipboard",e),console.log("[Kimi] Primed clipboard with unique token.")}catch(d){throw console.error("[Kimi] Failed to prime clipboard via Dart handler.",d),new Error("Could not set initial clipboard state for validation.")}const o=document.querySelectorAll(p.RESPONSE_CONTAINER);if(o.length===0)throw new Error("No response containers found.");const t=o[o.length-1];if(!t)throw new Error("Could not find last response container.");const n=await x(t,[p.COPY_BUTTON],w(5e3));if(!n.offsetParent)throw new Error("Copy button is not visible.");n.scrollIntoView({behavior:"smooth",block:"center"}),await new Promise(d=>setTimeout(d,200));const i=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,view:window}),r=new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,view:window}),a=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});n.dispatchEvent(i),await new Promise(d=>setTimeout(d,50)),n.dispatchEvent(r),await new Promise(d=>setTimeout(d,50)),n.dispatchEvent(a),console.log('[Kimi] "Copy" button clicked with full mouse event sequence. Waiting before polling...'),await new Promise(d=>setTimeout(d,300));const c=150,l=40;for(let d=0;d<l;d++){await new Promise(u=>setTimeout(u,c));try{const u=await window.flutter_inappwebview.callHandler("readClipboard");if(typeof u=="string"&&u.trim()&&u!==e)return console.log(`[Kimi] Clipboard updated. Successfully extracted ${u.length} chars (attempt ${d+1}).`),u}catch(u){console.warn(`[Kimi] Clipboard read attempt ${d+1} failed, retrying...`,u)}}let E="";try{const d=await window.flutter_inappwebview.callHandler("readClipboard");E=` Final clipboard state: ${typeof d=="string"?`"${d.substring(0,50)}..."`:"non-string"}`}catch(d){E=` Could not read final clipboard state: ${d}`}throw new Error(`Extraction failed: Clipboard content did not change from the unique token after the copy operation.${E} Tried ${l} times over ${l*c/1e3}s.`)}}const Ee=new de,Te=100,me=300,ge=0,fe=100;function W(){if(window.flutter_inappwebview&&typeof window.flutter_inappwebview.callHandler=="function")try{window.flutter_inappwebview.callHandler(V),console.log("[Engine] Bridge ready signal sent to Flutter.")}catch(s){console.warn("[Engine] Failed to send bridge ready signal:",s)}}document.addEventListener("flutterInAppWebViewPlatformReady",()=>{console.log("[Engine] Received flutterInAppWebViewPlatformReady event"),W()});function D(s=Te,e=me){if(s<=0){console.warn("[Engine] Max retries reached for bridge ready signal.");return}window.flutter_inappwebview&&typeof window.flutter_inappwebview.callHandler=="function"?W():setTimeout(()=>D(s-1,e),e)}if(window.__AI_HYBRID_HUB_INITIALIZED__&&(console.log("[Engine] Bridge script already initialized. Checking if functions exist..."),typeof window.startAutomation<"u"&&typeof window.extractFinalResponse<"u"&&typeof window.inspectDOMForSelectors<"u"?(console.log("[Engine] Functions exist, signaling ready."),D()):(console.warn("[Engine] Flag set but functions missing! Force re-initialization."),delete window.__AI_HYBRID_HUB_INITIALIZED__)),!window.__AI_HYBRID_HUB_INITIALIZED__){let s=function(n){const i=t[n];return i?(console.log(`[Engine] Matched providerId: "${n}". Using corresponding chatbot module.`),i):(console.error(`[Engine] No chatbot module found for providerId: "${n}"`),null)},e=function(n,i=document){try{const r=i.querySelector(n);if(r)return r;const a=i.querySelectorAll("*");for(const c of a)if(c.shadowRoot){const l=e(n,c.shadowRoot);if(l)return l}}catch{}return null};window.__AI_HYBRID_HUB_INITIALIZED__=!0,window.__processedFootersCount=ge;const o={currentChatbot:null},t={ai_studio:new q,kimi:Ee};window.startAutomation=async function(n){console.log("[Engine LOG] >>> Full automation cycle started by Dart. Options:",JSON.stringify(n,null,2)),window.__hasAttemptedRetry=!1,window.__AI_TIMEOUT_MODIFIER__=n.timeoutModifier??1,console.log(`[Engine] Using timeout modifier: ${window.__AI_TIMEOUT_MODIFIER__}x`);const i=s(n.providerId);if(!i){I({type:N,errorCode:"UNSUPPORTED_PROVIDER",payload:`Provider "${n.providerId}" is not supported.`});return}o.currentChatbot=i;const r=Date.now();let a="Initialization";try{i.resetState&&(a="Phase 1: Resetting UI state",console.log(`[Engine LOG] ${a}...`),await i.resetState()),a="Phase 2: Waiting for UI to be ready",console.log(`[Engine LOG] ${a}...`),await i.waitForReady(),a="Phase 3: Applying configurations",console.log(`[Engine LOG] ${a}...`),n.systemPrompt&&i.setSystemPrompt&&(console.log(`[Engine LOG] Setting system prompt (length: ${n.systemPrompt.length})`),await i.setSystemPrompt(n.systemPrompt)),i.applyAllSettings&&await i.applyAllSettings(n),a="Phase 4: Entering and sending prompt",console.log(`[Engine LOG] ${a}...`),await i.sendPrompt(n.prompt),a="Phase 5: Starting response observer",console.log(`[Engine LOG] ${a}...`),i.startResponseObserver&&await i.startResponseObserver();const c=Date.now()-r;console.log(`[Engine LOG] Full automation cycle initiated successfully in ${c}ms. Now observing for response.`)}catch(c){const l=c instanceof Error?c.message:String(c),E=Date.now()-r,d={url:window.location.href,readyState:document.readyState,visibleElements:document.querySelectorAll("*").length};console.error(`[Engine LOG] Full automation cycle failed in ${a} after ${E}ms!`,c);const u={phase:a,elapsedTimeMs:E,url:d.url,readyState:d.readyState,visibleElements:d.visibleElements,timestamp:new Date().toISOString()};throw(l.includes("Selector")||l.includes("selector"))&&(u.selectorContext="Error message contains selector information"),I({type:N,errorCode:"FULL_CYCLE_FAILED",location:"startAutomation",payload:l,diagnostics:u}),c}},window.extractFinalResponse=async function(){console.log("[Engine LOG] extractFinalResponse called");const n=o.currentChatbot;if(!n){const r="No chatbot available for extraction. Automation must be started first.";throw console.error("[Engine LOG] No chatbot found for extraction"),I({type:N,errorCode:"NO_CHATBOT_INSTANCE",payload:r}),new Error(r)}const i=Date.now();console.log(`[Engine LOG] Starting extraction with chatbot: ${n.constructor.name}`);try{console.log("[Engine LOG] [ENHANCED] DOM state before extraction:",{url:window.location.href,readyState:document.readyState,title:document.title,timestamp:new Date().toISOString()});const r=await n.extractResponse(),a=Date.now()-i;return console.log(`[Engine LOG] Extraction completed successfully in ${a}ms, extracted ${r.length} chars`),console.log("[Engine LOG] [ENHANCED] Extraction result details:",{success:!0,resultLength:r.length,resultPreview:r.substring(0,100)+(r.length>100?"...":""),elapsedTime:a}),r}catch(r){const a=r instanceof Error?r.message:String(r),c=Date.now()-i;console.error("[Engine LOG] [ENHANCED] Extraction failed with details:",{success:!1,errorMessage:a,errorType:r instanceof Error?r.constructor.name:typeof r,elapsedTime:c,timestamp:new Date().toISOString(),domState:{url:window.location.href,readyState:document.readyState,title:document.title,editButtons:document.querySelectorAll('button[aria-label="Edit"]').length,textareas:document.querySelectorAll('textarea, [contenteditable="true"]').length}});const l=`Extraction failed: ${a} (Type: ${r instanceof Error?r.constructor.name:typeof r}, Time: ${c}ms)`;throw console.error(`[Engine LOG] ${l}`),I({type:N,errorCode:"EXTRACTION_FAILED",payload:l}),r}},window.inspectDOMForSelectors=function(){const n={inputs:[],buttons:[],allSelectorsTested:{},shadowDOMDetected:!1},i=document.querySelectorAll("*");for(const u of i)if(u.shadowRoot){n.shadowDOMDetected=!0;break}const r=["textarea[placeholder*='prompt']","input[placeholder*='prompt']","textarea","input[type='text']"],a={};for(const u of r)try{a[u]=document.querySelector(u),a[u]||(a[`${u} (shadow)`]=e(u))}catch{a[u]=null}n.allSelectorsTested.promptInput=a;const c=['button[aria-label*="Run"]','button[aria-label*="Send"]','button[type="submit"]',"button"],l={};for(const u of c)try{l[u]=document.querySelector(u),l[u]||(l[`${u} (shadow)`]=e(u))}catch{l[u]=null}n.allSelectorsTested.sendButton=l;const E=Array.from(document.querySelectorAll('input, textarea, [contenteditable="true"]'));n.inputs=E.map(u=>{const m=u;return{tag:u.tagName.toLowerCase(),type:m.getAttribute("type")||"",placeholder:m.getAttribute("placeholder")||"",ariaLabel:m.getAttribute("aria-label")||"",id:u.id||"",className:u.className||"",contentEditable:m.contentEditable,visible:m.offsetParent!==null,inShadowDOM:!1}});const d=Array.from(document.querySelectorAll("button"));return n.buttons=d.map(u=>{const m=u;return{tag:u.tagName.toLowerCase(),ariaLabel:m.getAttribute("aria-label")||"",text:(m.innerText||"").substring(0,fe),id:u.id||"",className:u.className||"",type:m.getAttribute("type")||"",visible:m.offsetParent!==null,inShadowDOM:!1}}),n},console.log("[Engine] Bridge script injected. Waiting for flutter_inappwebview..."),D()}})();
